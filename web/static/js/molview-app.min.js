/*! MolView JavaScript App build on 2017-02-26 */
function AutocompleteBuilder(a,b){this.array=a,this.key=b}var History={init:function(){window.addEventListener("popstate",function(a){var b=getQuery();JSON.stringify(b)!==JSON.stringify(MolView.query)&&(document.title="MolView",MolView.query=b,MolView.executeQuery())})},push:function(a,b,c){b=""+b,MolView.query={},MolView.query[a]=b;var d=a+"="+specialEncodeURIComponent(b.replace(/^ /,""));history&&history.replaceState&&history.pushState&&location.search.indexOf(d)===-1&&(""===location.search||c?history.replaceState(null,document.title,"?"+d):history.pushState(null,document.title,"?"+d))}},Sketcher={molpad:void 0,metadata:{cid:void 0,inchi:void 0,inchikey:void 0,smiles:void 0},init:function(){MPFragments.init(),this.initPeriodicTable(),this.resizeToolbars(),$("#action-mp-color-mode").toggleClass("tool-button-selected",Preferences.get("sketcher","colored",!0)),$("#action-mp-skeletal-formula").toggleClass("tool-button-selected",!Preferences.get("sketcher","skeletal_formula",!0)),Detector.canvas?(this.molpad=new MolPad(document.getElementById("molpad-canvas-wrapper"),MolView.devicePixelRatio,{undo:"#action-mp-undo",redo:"#action-mp-redo"}),this.molpad.setSkeletalDisplay(Preferences.get("sketcher","skeletal_formula",!0)),this.setColored(Preferences.get("sketcher","colored",!0)),this.setTool($("#action-mp-lasso"),"select",{type:"lasso"}),MolView.loadDefault&&this.loadMOL(defaultMol2D),this.molpad.onChange(function(){Sketcher.metadata={},Sketcher.molpad.mol.copy.fingerprint===Sketcher.fingerprint?Sketcher.markUpdated():Sketcher.markOutdated()})):Messages.alert("no_canvas_support")},resize:function(){this.molpad&&(this.resizeToolbars(),this.molpad.resize())},resizeToolbars:function(){var a=40+$("#edit-tools").css("height",40).scrollTop(40).scrollTop(),b=40+$("#chem-tools").css("width",40).scrollLeft(40).scrollLeft(),c=40+$("#elem-tools").css("width",40).scrollLeft(40).scrollLeft();$("#edit-tools").css({left:b,height:a}),$("#chem-tools").css({width:b}),$("#elem-tools").css({top:a,width:c}),$("#molpad-canvas-wrapper").css({top:a,left:b,right:c})},initPeriodicTable:function(){var a=PeriodicTable.table;a.push({elements:PeriodicTable.lanthanoids}),a.push({elements:PeriodicTable.actinoids});for(var b=0;b<a.length;b++){for(var c=-1,d=0;d<a[b].elements.length;d++){var e=a[b].elements[d];if(""!==e.name){for(var f=c;f<e.position-1;f++)$('<div class="pt-space"></div>').appendTo("#periodictable");$('<div class="pt-element"></div>').attr("title",e.name).append($("<h3></h3>").html(e.number)).append($("<h4></h4>").html(e.small).css("color",JmolAtomColorsHashHex[e.small])).data("element",e.small).on(MolView.trigger,function(){$("#molpad .primary-tool").removeClass("tool-button-selected"),$("#action-mp-periodictable").addClass("tool-button-selected"),Sketcher.molpad.setTool("atom",{element:$(this).data("element")}),MolView.hideDialogs()}).appendTo("#periodictable"),c=e.position}}$("<br/>").appendTo("#periodictable")}},loadMOL:function(a){this.molpad&&this.molpad.loadMOL(a)},getMOL:function(){return this.molpad?this.molpad.getMOL():""},getSMILES:function(){return this.metadata.smiles?this.metadata.smiles:this.molpad?(this.metadata.smiles=this.molpad.getSMILES(),this.metadata.smiles):""},setTool:function(a,b,c){this.molpad&&this.molpad.setTool(b,c),$(".primary-tool").removeClass("tool-button-selected"),$(a).addClass("tool-button-selected")},clear:function(){this.molpad&&this.molpad.clear()},undo:function(){this.molpad&&this.molpad.undo()},redo:function(){this.molpad&&this.molpad.redo()},setColored:function(a){this.molpad&&($(".tool-element").toggleClass("element-colored",a),Preferences.set("sketcher","colored",a),this.molpad.setColored(a))},toggleColorMode:function(){this.molpad&&this.setColored($("#action-mp-color-mode").toggleClass("tool-button-selected").hasClass("tool-button-selected"))},toggleSkeletalFormula:function(){if(this.molpad){var a=!$("#action-mp-skeletal-formula").toggleClass("tool-button-selected").hasClass("tool-button-selected");Preferences.set("sketcher","skeletal_formula",a),this.molpad.setSkeletalDisplay(a)}},center:function(){this.molpad&&this.molpad.center()},clean:function(){Messages.process(Loader.clean,"clean")},markOutdated:function(){$("#action-resolve").addClass("resolve-outdated")},markUpdated:function(){this.fingerprint=this.molpad.mol.copy.fingerprint,$("#action-resolve").removeClass("resolve-outdated")},toDataURL:function(){return this.molpad?this.molpad.toDataURL():""}},SearchGrid={db:"",init:function(){$("#search-layer").on("scroll",function(a){$("#search-layer").scrollTop()+$("#search-layer").outerHeight()>$("#search-layer > .container").outerHeight()&&("pubchem"===SearchGrid.db?Actions.load_more_pubchem():"rcsb"===SearchGrid.db?Actions.load_more_rcsb():"cod"===SearchGrid.db&&Actions.load_more_cod())})},clear:function(){$("#search-layer").scrollTop(),$("#search-layer .container").empty().css("margin-bottom",0)},setDatabase:function(a){this.db=a,$("#action-load-more-pubchem").css("display","pubchem"===a?"block":"none"),$("#action-load-more-rcsb").css("display","rcsb"===a?"block":"none"),$("#action-load-more-cod").css("display","cod"===a?"block":"none")},startLoading:function(){$("#action-load-more-"+this.db).addClass("load-more-progress")},endLoading:function(a){a?($(".load-more").css("display","none"),$("#search-layer .container").css("margin-bottom",100)):$("#action-load-more-"+this.db).removeClass("load-more-progress")},addEntry:function(a){if("pubchem"===this.db){if(!a.CID)return;var b=$('<a class="search-result search-result-pubchem"></a>').attr("href","?cid="+a.CID).appendTo("#search-layer .container");if(a.Title){var c=$('<div class="search-result-title"><span>'+ucfirst(humanize(a.Title))+"</span></div>");b.append(c),c.textfill({maxFontPoints:26})}var d=$('<div class="search-result-img-wrap"></div>'),e=new Image;e.onload=function(){d.css("background-image","none")},e.src=Request.PubChem.image(a.CID,b.width()),$("<div class='search-result-img'></div>").css("background-image","url("+e.src+")").css("-webkit-filter","url('#pubchemImageFilter')").css("-moz-filter","url('#pubchemImageFilter')").css("-ms-filter","url('#pubchemImageFilter')").css("-o-filter","url('#pubchemImageFilter')").css("filter","url('#pubchemImageFilter')").height(b.width()).appendTo(d.appendTo(b)),b.data("cid",a.CID),b.data("title",ucfirst(humanize(a.Title))),b.on("click",function(a){if(2!==a.which)return MolView.pushEvent("button","click","pubchem search",0),MolView.setLayer("main"),Loader.PubChem.loadCID($(this).data("cid"),$(this).data("title")),!1})}else if("rcsb"===this.db){if(!a.structureId||!a.structureTitle)return;var b=$('<div class="search-result"></div>').appendTo("#search-layer .container"),c=$('<a class="search-result-title"><span>'+a.structureId+"</span></a>").attr("href","?pdbid="+a.structureId);b.append(c),c.textfill({maxFontPoints:26});var f=500/MolView.devicePixelRatio,d=$('<div class="search-result-img-wrap"></div>'),e=new Image;e.onload=function(){d.css("background-image","none")},e.src=Request.RCSB.image(a.structureId),$('<div class="search-result-img"></div>').css("background-image","url("+e.src+")").css("background-size",f>250?250:f).height(b.width()).appendTo(d.appendTo(b));var g=$('<div class="search-result-description">'+ucfirst(humanize(a.structureTitle))+"</div>");b.append(g),c.data("pdbid",a.structureId),c.on("click",function(a){if(2!==a.which)return MolView.pushEvent("button","click","rcsb search",0),MolView.setLayer("main"),Loader.RCSB.loadPDBID($(this).data("pdbid")),!1})}else if("cod"===this.db){if(!a.codid)return;var b=$('<div class="search-result"></div>').appendTo("#search-layer .container");a.formula=formatMFormula(a.formula);var h=a.mineral||a.commonname||a.chemname||a.formula||a.codid,c=$('<a class="search-result-title"><span>'+h+"</span></a>").attr("href","?codid="+a.codid);b.append(c),c.textfill({maxFontPoints:26}),$('<div class="search-result-codid">'+a.codid+"</div>").appendTo(b);var g=$('<div class="search-result-description search-result-description-cod"></div>').appendTo(b);a.title&&$('<div class="expandable"><div class="expandable-title"><span>Details</span></div><div class="expandable-content">'+formatHTMLLinks(formatMFormula(a.title))+"</div></div>").appendTo(g).children(".expandable-title").on(MolView.trigger,function(a){$(this).parent().toggleClass("open")}),a.mineral&&$("<p><b>Mineral name</b><br/><span>"+a.mineral+"</span></p>").appendTo(g),a.commonname&&$("<p><b>Common name</b><br/><span>"+a.commonname+"</span></p>").appendTo(g),a.chemname&&$("<p><b>Chemical name</b><br/><span>"+a.chemname+"</span></p>").appendTo(g),a.formula&&$("<p><b>Molecular formula</b><br/><span>"+formatMFormula(a.formula.replace(/-/g,"").replace(/\s/g,""))+"</span></p>").appendTo(g),c.data("codid",a.codid),c.data("title",h),c.on("click",function(a){if(2!==a.which)return MolView.pushEvent("button","click","cod search",0),MolView.setLayer("main"),Loader.COD.loadCODID($(this).data("codid"),$(this).data("title")),!1})}}},Loader={lastQuery:{type:"",content:""},setQuery:function(a,b,c){b=String(b),this.lastQuery.type=a,this.lastQuery.content=b,History.push(a,b,c),$("#model-source").removeClass("disabled"),"q"===a||"smiles"===a?$("#model-source").text("3D model source").removeAttr().addClass("disabled"):"cid"===a?$("#model-source").text("PubChem source").attr("href",Request.PubChem.staticURL(b)):"pdbid"===a?$("#model-source").text("RCSB source").attr("href",Request.RCSB.staticURL(b)):"codid"===a&&$("#model-source").text("COD source").attr("href",Request.COD.staticURL(b))},CIRsearch:function(a,b){if(!Request.CIR.available)return void Messages.alert("cir_func_down");b||Progress.reset(3);var c=a||$("#search-input").val();Request.CIRsearch(c,function(a,b,c){Sketcher.loadMOL(a),Sketcher.markUpdated(),Model.loadMOL(b),c=ucfirst(c),document.title=c,Progress.complete(),Messages.clear(),Loader.setQuery("q",c)},function(){Messages.alert("load_fail")})},PubChem:{i:0,step:10,loading:!1,ssli:1e3,loadCIDS:function(a){0!==a.length&&Request.PubChem.description(a,function(a){for(var b=[],c=0;c<a.InformationList.Information.length;c++){var d=a.InformationList.Information[c].CID;b.indexOf(d)===-1&&(b.push(d),SearchGrid.addEntry(a.InformationList.Information[c]))}SearchGrid.endLoading(Loader.PubChem.i>=Request.PubChem.data.length),Loader.PubChem.loading=!1,Progress.complete()},function(){Messages.alert("remote_noreach")})},loadNextSet:function(){if(!this.loading&&this.i<Request.PubChem.data.length){this.loading=!0,SearchGrid.startLoading();var a=this.i,b=this.i+this.step;b>Request.PubChem.data.length&&(b=Request.PubChem.data.length),this.loadCIDS(Request.PubChem.data.slice(a,b)),this.i=b}},search:function(){var a=$("#search-input").val();Progress.reset(3),Request.PubChem.search(a,function(){Messages.clear(),Actions.show_search_layer(),SearchGrid.setDatabase("pubchem"),SearchGrid.clear(),Loader.PubChem.i=0,Loader.PubChem.loadNextSet()},function(a){Messages.alert(404===a?"search_notfound":"search_fail")})},structureSearch:function(a,b,c){Progress.reset(3),Request.PubChem.structureSearch(a,b,c,function(a){function b(){Request.PubChem.list(a,function(){Progress.increment(),Messages.clear(),Actions.show_search_layer(),SearchGrid.setDatabase("pubchem"),SearchGrid.clear(),Loader.PubChem.i=0,Loader.PubChem.loadNextSet()},function(c){a=c,window.setTimeout(b,Loader.PubChem.ssli)},function(a){Messages.alert("search_fail")})}Progress.increment(),b()},function(a){Messages.alert(404===a?"search_notfound":"search_fail")})},loadName:function(a,b){Progress.reset(b?9:6),Messages.process(function(){Request.PubChem.nameToCID(a,function(b){Progress.increment(),Loader.PubChem._loadCID(b,ucfirst(a))},function(){b?Loader.CIRsearch(a,!0):Messages.alert("load_fail")})},"compound")},loadCID:function(a,b){Progress.reset(4),b=ucfirst(b),Messages.process(function(){Loader.PubChem._loadCID(a,b)},"compound")},_loadCID:function(a,b){Request.PubChem.sdf(a,!0,function(c){Sketcher.loadMOL(c),Sketcher.metadata.cid=a,Sketcher.markUpdated(),Progress.increment(),Request.PubChem.sdf(a,!1,function(c){Model.loadMOL(c),document.title=b||"MolView",Loader.setQuery("cid",a),Progress.complete(),Messages.clear()},function(){Progress.increment();var d;try{d=Sketcher.getSMILES()}catch(d){return Model.loadMOL(c),Sketcher.markUpdated(),document.title=b||"MolView",Loader.setQuery("cid",a),Progress.complete(),void Messages.clear()}Progress.increment(),Request.CIR.resolve(d,!1,function(c){Model.loadMOL(c),Sketcher.markUpdated(),document.title=b||"MolView",Loader.setQuery("cid",a),Progress.complete(),Messages.clear()},function(){Model.loadMOL(c),Sketcher.markUpdated(),document.title=b||"MolView",Loader.setQuery("cid",a),Progress.complete(),Messages.clear()})})},function(){Messages.alert("load_fail")})}},RCSB:{i:0,step:10,loading:!1,loadPDBIDS:function(a){0!==a.length&&Request.RCSB.information(a,function(a){for(var b=0;b<a.dataset.length;b++)SearchGrid.addEntry(a.dataset[b]);SearchGrid.endLoading(Loader.RCSB.i>=Request.RCSB.data.length),Loader.RCSB.loading=!1,Progress.complete()},function(){Messages.alert("remote_noreach")})},loadNextSet:function(){if(!this.loading&&this.i<Request.RCSB.data.length){this.loading=!0,SearchGrid.startLoading();var a=this.i,b=this.i+this.step;b>Request.RCSB.data.length&&(b=Request.RCSB.data.length),this.loadPDBIDS(Request.RCSB.data.slice(a,b)),this.i=b}},search:function(){var a=$("#search-input").val();Progress.reset(3),Request.RCSB.search(a,function(){Messages.clear(),Actions.show_search_layer(),SearchGrid.setDatabase("rcsb"),SearchGrid.clear(),Loader.RCSB.i=0,Loader.RCSB.loadNextSet()},function(){Messages.alert("search_fail")})},loadPDBID:function(a,b){function c(){Sketcher.markOutdated(),document.title=b||a.toUpperCase(),Progress.complete(),Messages.clear(),Loader.setQuery("pdbid",a)}Progress.reset(2),MolView.setLayout("model"),Messages.process(function(){Progress.increment(),Request.RCSB.PDB(a,function(a){Detector.webgl?Model.isGLmol()?(Model.loadPDB(a),c()):(Model.preloadPDB(a),Model.setRenderEngine("GLmol",c)):MolView.mobile?Messages.alert("mobile_old_no_macromolecules"):Model.isJSmol()?(Model.loadPDB(a),c()):(Model.preloadPDB(a),Model.setRenderEngine("JSmol",c))},function(){Messages.alert("load_fail")})},"macromolecule")}},COD:{i:0,step:10,loading:!1,loadNextSet:function(){SearchGrid.startLoading(),window.setTimeout(function(){if(!this.loading&&this.i<Request.COD.data.length){for(var a=this.i+this.step;this.i<Request.COD.data.length&&this.i<a;this.i++)SearchGrid.addEntry(Request.COD.data[this.i]);SearchGrid.endLoading(Loader.COD.i>=Request.COD.data.length),this.loading=!1,Progress.complete()}}.bind(this),300)},search:function(){var a=$("#search-input").val();Progress.reset(3),Request.COD.search(a,function(){Messages.clear(),Actions.show_search_layer(),SearchGrid.setDatabase("cod"),SearchGrid.clear(),Loader.COD.i=0,Loader.COD.loadNextSet()},function(a){Messages.alert(a?"remote_noreach":"search_fail")})},loadCODID:function(a,b,c){function d(){document.title=b||"COD: "+a,Progress.complete(),Messages.clear(),Loader.setQuery("codid",a)}function e(b){Request.COD.smiles(a,function(a){Progress.increment(),""===a.records[0].smiles?b(null):Request.CIR.resolve(a.records[0].smiles,!0,function(c){b(c,a.records[0].smiles)},function(){b(null)})},function(){b(null)})}function f(){e(function(a,b){a?(Sketcher.metadata.smiles=b,Sketcher.loadMOL(a,!0),Sketcher.markUpdated(),d(),Messages.alert("crystal_2d_unreliable")):(d(),Messages.alert("crystal_2d_fail"))})}function g(a){Request.PubChem.nameToCID(a,function(a){Progress.increment(),Request.PubChem.sdf(a,!0,function(b){Sketcher.metadata.cid=a,Sketcher.loadMOL(b),Sketcher.markUpdated(),d(),Messages.alert("crystal_2d_unreliable")},function(){d(),Messages.alert("crystal_2d_fail")})},f)}Progress.reset(4),MolView.makeModelVisible(),Messages.process(function(){Request.COD.CIF(a,function(d){Model.loadCIF(d,[1,1,1],function(){Progress.increment(),void 0!==c?Request.PubChem.primaryName(c,function(a){Progress.increment(),a.toLowerCase()===c.toLowerCase()?g(a):f()},f):void 0===b||"MolView"===b?Request.COD.name(a,function(a){Progress.increment(),""!==a.records[0].name?g(a.records[0].name):f()},f):g(b)})},function(){Messages.alert("load_fail")})},"crystal")}},clean:function(){Progress.reset(4);var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error",a)}Request.resolve(a,0,!0,function(a,b){Sketcher.loadMOL(a),Progress.complete(),Messages.clear()},function(){Messages.alert("load_fail")})},resolve:function(){Progress.reset(4);var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error",a)}Request.resolve(a,0,!1,function(b,c){Messages.alert("resolved_3d_unreliable"),Model.loadMOL(b),Sketcher.markUpdated(),c>0?(Sketcher.metadata.cid=c,Loader.setQuery("cid",c)):Loader.setQuery("smiles",a),Progress.complete(),Messages.clear(),document.title="MolView","sketcher"===MolView.layout&&MolView.setLayout("model")},function(){Messages.alert("load_fail")})},loadSMILES:function(a,b){Progress.reset(4),Request.resolve(a,0,!1,function(c,d){Progress.increment(),Model.loadMOL(c),Request.resolve(a,d,!0,function(c,d){Sketcher.loadMOL(c),Sketcher.markUpdated(),d>0?(Sketcher.metadata.cid=d,Loader.setQuery("cid",d,!0)):Loader.setQuery("smiles",a),Progress.complete(),Messages.clear(),document.title=b||"MolView"},function(){Messages.alert("load_fail")})},function(){Messages.alert("load_fail")})}},Actions={layout_sketcher:function(){MolView.setLayout("sketcher")},layout_model:function(){MolView.setLayout("model")},layout_vsplit:function(){MolView.setLayout("vsplit")},layout_hsplit:function(){MolView.setLayout("hsplit")},theme_desktop:function(){MolView.setTheme("desktop")},theme_touch:function(){MolView.setTheme("touch")},help:function(){MolView.showDialog("help")},about:function(){MolView.showDialog("about")},share:function(){Link.updateShareDialog(),MolView.showDialog("share")},embed:function(){Link.updateEmbedDialog(),MolView.showDialog("embed")},export_sketcher_png:function(){var a=Sketcher.toDataURL(),b=dataURItoBlob(a);null!==b&&saveAs(b,document.title+" (structural formula).png")},export_model_png:function(){var a=Model.getImageDataURL(),b=dataURItoBlob(a);null!==b&&saveAs(b,document.title+" (model).png")},export_model:function(){var a=Model.getFileBlob();saveAs(a,document.title+"."+Model.getFileExstension().toLowerCase())},data_infocard:function(){var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error_force",a)}InfoCard.update(a),InfoCard.load(),MolView.setLayer("infocard")},data_spectra:function(){var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error_force",a)}Spectroscopy.data.smiles&&Spectroscopy.data.smiles===a?MolView.setLayer("spectra"):(Spectroscopy.update(a),MolView.setLayer("spectra")),Spectroscopy.resize()},search_substructure:function(){MolView.hideDialogs(),MolView.setLayer("main"),Messages.process(function(){if(Sketcher.metadata.cid)Loader.PubChem.structureSearch("cid",Sketcher.metadata.cid,"substructure");else{var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error_force",a)}Loader.PubChem.structureSearch("smiles",a,"substructure")}},"search")},search_superstructure:function(){MolView.hideDialogs(),MolView.setLayer("main"),Messages.process(function(){if(Sketcher.metadata.cid)Loader.PubChem.structureSearch("cid",Sketcher.metadata.cid,"superstructure");else{var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error_force",a)}Loader.PubChem.structureSearch("smiles",a,"superstructure")}},"search")},search_similarity:function(){MolView.hideDialogs(),MolView.setLayer("main"),Messages.process(function(){if(Sketcher.metadata.cid)Loader.PubChem.structureSearch("cid",Sketcher.metadata.cid,"similarity");else{var a;try{a=Sketcher.getSMILES()}catch(a){return void Messages.alert("smiles_load_error_force",a)}Loader.PubChem.structureSearch("smiles",a,"similarity")}},"search")},model_reset:function(){Model.reset()},model_balls:function(){Model.setRepresentation("balls")},model_stick:function(){Model.setRepresentation("stick")},model_vdw:function(){Model.setRepresentation("vdw")},model_wireframe:function(){Model.setRepresentation("wireframe")},model_line:function(){Model.setRepresentation("line")},model_bg_black:function(){Model.setBackground("black")},model_bg_gray:function(){Model.setBackground("gray")},model_bg_white:function(){Model.setBackground("white")},engine_glmol:function(){Messages.clear(),Messages.process(function(){Model.setRenderEngine("GLmol",Messages.clear)},"switch_engine")},engine_jmol:function(){Messages.clear(),Messages.process(function(){Model.setRenderEngine("JSmol",Messages.clear)},"switch_engine")},engine_cdw:function(){Messages.clear(),Messages.process(function(){Model.setRenderEngine("CDW",Messages.clear)},"switch_engine")},cif_unit_cell:function(){Model.isCIF()&&Messages.process(function(){Model.loadCIF(Model.data.cif,[1,1,1]),Messages.clear()},"crystal_structure")},cif_cubic_supercell:function(){Model.isCIF()&&Messages.process(function(){Model.loadCIF(Model.data.cif,[2,2,2]),Messages.clear()},"crystal_structure")},cif_flat_supercell:function(){Model.isCIF()&&Messages.process(function(){Model.loadCIF(Model.data.cif,[1,3,3]),Messages.clear()},"crystal_structure")},bio_assembly:function(){Model.setBioAssembly(!Model.displayBU)},chain_type_ribbon:function(){Model.setChainType($("#action-chain-type-ribbon").hasClass("checked")?"none":"ribbon")},chain_type_cylinders:function(){Model.setChainType($("#action-chain-type-cylinders").hasClass("checked")?"none":"cylinders")},chain_type_btube:function(){Model.setChainType($("#action-chain-type-btube").hasClass("checked")?"none":"btube")},chain_type_ctrace:function(){Model.setChainType($("#action-chain-type-ctrace").hasClass("checked")?"none":"ctrace")},chain_type_bonds:function(){Model.setChainBonds(!$("#action-chain-type-bonds").hasClass("checked"))},chain_color_ss:function(){Model.setChainColor("ss")},chain_color_spectrum:function(){Model.setChainColor("spectrum")},chain_color_chain:function(){Model.setChainColor("chain")},chain_color_residue:function(){Model.setChainColor("residue")},chain_color_polarity:function(){Model.setChainColor("polarity")},chain_color_bfactor:function(){Model.setChainColor("bfactor")},jmol_clean:function(){Model.JSmol.clean()},jmol_hq:function(){Model.JSmol.setQuality(!$("#action-jmol-hq").hasClass("checked"))},jmol_mep_lucent:function(){Model.JSmol.loadMEPSurface(!0)},jmol_mep_opaque:function(){Model.JSmol.loadMEPSurface(!1)},jmol_charge:function(){Model.JSmol.displayCharge()},jmol_bond_dipoles:function(){Model.JSmol.displayDipoles()},jmol_net_dipole:function(){Model.JSmol.displayNetDipole()},jmol_minimize:function(){Model.JSmol.calculateEnergyMinimization()},jmol_measure_distance:function(){Model.JSmol.setMeasure($("#action-jmol-measure-distance").hasClass("checked")?"OFF":"DISTANCE")},jmol_measure_angle:function(){Model.JSmol.setMeasure($("#action-jmol-measure-angle").hasClass("checked")?"OFF":"ANGLE")},jmol_measure_torsion:function(){Model.JSmol.setMeasure($("#action-jmol-measure-torsion").hasClass("checked")?"OFF":"TORSION")},search_pubchem:function(){""===$("#search-input").val()?MolView.alertEmptyInput():($("#search-input").blur(),MolView.hideDialogs(),Messages.process(Loader.PubChem.search,"search"))},search_rcsb:function(){""===$("#search-input").val()?MolView.alertEmptyInput():($("#search-input").blur(),MolView.hideDialogs(),Messages.process(Loader.RCSB.search,"search"))},search_cod:function(){""===$("#search-input").val()?MolView.alertEmptyInput():($("#search-input").blur(),MolView.hideDialogs(),Messages.process(Loader.COD.search,"search"))},show_search_layer:function(){MolView.setLayer("search")},load_more_pubchem:function(){Loader.PubChem.loadNextSet()},load_more_rcsb:function(){Loader.RCSB.loadNextSet()},load_more_cod:function(){Loader.COD.loadNextSet()},mp_bond_single:function(){Sketcher.setTool(this,"bond",{type:MP_BOND_SINGLE})},mp_bond_double:function(){Sketcher.setTool(this,"bond",{type:MP_BOND_DOUBLE})},mp_bond_triple:function(){Sketcher.setTool(this,"bond",{type:MP_BOND_TRIPLE})},mp_bond_wedge:function(){Sketcher.setTool(this,"bond",{stereo:MP_STEREO_UP})},mp_bond_hash:function(){Sketcher.setTool(this,"bond",{stereo:MP_STEREO_DOWN})},mp_frag_benzene:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.benzene})},mp_frag_cyclopropane:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.cyclopropane})},mp_frag_cyclobutane:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.cyclobutane})},mp_frag_cyclopentane:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.cyclopentane})},mp_frag_cyclohexane:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.cyclohexane})},mp_frag_cycloheptane:function(){Sketcher.setTool(this,"fragment",{frag:MPFragments.cycloheptane})},mp_chain:function(){Sketcher.setTool(this,"chain",{})},mp_charge_add:function(){Sketcher.setTool(this,"charge",{charge:1})},mp_charge_sub:function(){Sketcher.setTool(this,"charge",{charge:-1})},mp_clear:function(){Sketcher.clear()},mp_eraser:function(){Sketcher.setTool(this,"erase",{})},mp_drag:function(){Sketcher.setTool(this,"drag",{})},mp_undo:function(){Sketcher.undo()},mp_redo:function(){Sketcher.redo()},mp_rect:function(){Sketcher.setTool(this,"select",{type:"rect"})},mp_lasso:function(){Sketcher.setTool(this,"select",{type:"lasso"})},mp_color_mode:function(){Sketcher.toggleColorMode()},mp_skeletal_formula:function(){Sketcher.toggleSkeletalFormula()},mp_center:function(){Sketcher.center()},mp_clean:function(){Sketcher.clean()},mp_atom_c:function(){Sketcher.setTool(this,"atom",{element:"C"})},mp_atom_h:function(){Sketcher.setTool(this,"atom",{element:"H"})},mp_atom_n:function(){Sketcher.setTool(this,"atom",{element:"N"})},mp_atom_o:function(){Sketcher.setTool(this,"atom",{element:"O"})},mp_atom_p:function(){Sketcher.setTool(this,"atom",{element:"P"})},mp_atom_s:function(){Sketcher.setTool(this,"atom",{element:"S"})},mp_atom_f:function(){Sketcher.setTool(this,"atom",{element:"F"})},mp_atom_cl:function(){Sketcher.setTool(this,"atom",{element:"Cl"})},mp_atom_br:function(){Sketcher.setTool(this,"atom",{element:"Br"})},mp_atom_i:function(){Sketcher.setTool(this,"atom",{element:"I"})},mp_periodictable:function(){MolView.showDialog("periodictable")},resolve:function(){Messages.process(Loader.resolve,"resolve")},start_help:function(){MolView.showDialog("help")},export_spectrum_png:function(){if(!Spectroscopy.data[$("#spectrum-select").val()])return void alert("No spectrum selected!");var a=document.getElementById("spectrum-canvas").toDataURL("image/png"),b=dataURItoBlob(a);null!==b&&saveAs(b,$("#spectrum-select").find("option:selected").text()+".png")},export_spectrum_jcamp:function(){if(!Spectroscopy.data[$("#spectrum-select").val()])return void alert("No spectrum selected!");var a=new Blob([Spectroscopy.data[$("#spectrum-select").val()]],{type:"chemical/x-jcamp-dx;charset=utf-8"});null!==a&&saveAs(a,$("#spectrum-select").find("option:selected").text()+".jdx")}};$.fn.share=function(a,b,c){var d="View chemical structures using this free webapp!";this.children().each(function(){if($(this).hasClass("share-facebook")){var e=$(this);e.empty().unbind(),b?AJAX({url:"https://api.facebook.com/method/fql.query?query="+encodeURIComponent("select total_count from link_stat where url='"+(a.fb||a.all)+"'")+"&format=json&callback=?",dataType:"jsonp",success:function(a){e.data("total_count",a[0].total_count),$("<span></span>").html(""+a[0].total_count+" Likes").appendTo(e)}}):$("<span></span>").html("Facebook").appendTo(e),e.on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a.fb||a.all))})}else if($(this).hasClass("share-twitter")){var e=$(this);e.empty().unbind(),b?AJAX({url:"http://cdn.api.twitter.com/1/urls/count.json?url="+encodeURIComponent(a.twitter||a.all)+"&callback=?",dataType:"jsonp",success:function(a){e.data("count",a.count),$("<span></span>").html(""+a.count+" Tweets").appendTo(e)}}):$("<span></span>").html("Twitter").appendTo(e),e.on("click",function(){window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(c||d)+"&url="+encodeURIComponent(a.twitter||a.all)+"&via=molview")})}else if($(this).hasClass("share-googleplus")){var e=$(this);e.empty().unbind(),b?AJAX({url:"api/gplus?url="+encodeURIComponent(a.gplus||a.all),dataType:"json",success:function(a){e.data("count",a.count),$("<span></span>").html(""+a.count+" +1's").appendTo(e)}}):$("<span></span>").html("Google+").appendTo(e),e.on("click",function(){window.open("https://plus.google.com/share?hl=en-US&url="+encodeURIComponent(a.gplus||a.all))})}})};var Link={embedHTML:"",init:function(){$("#embed-width, #embed-height").on("keyup",this.updateEmbedDialog)},updateShareDialog:function(){$("#action-resolve").hasClass("resolve-outdated")&&"model"!==MolView.layout?$("#share-2d-not-3d").show():$("#share-2d-not-3d").hide();var a=window.location.origin+window.location.pathname,b="";""!==Loader.lastQuery.type&&(b="Cool structure on MolView!",a+="?"+Loader.lastQuery.type+"="+specialEncodeURIComponent(Loader.lastQuery.content.replace(/^ /,""))),$("#share-link").val(a),$("#share-dialog .social").share({all:a},!1,b)},updateEmbedDialog:function(){$("#action-resolve").hasClass("resolve-outdated")&&"model"!==MolView.layout?$("#embed-2d-not-3d").show():$("#embed-2d-not-3d").hide();var a="https://embed.molview.org/v1/?mode="+Model.representation;oneOf(Loader.lastQuery.type,["smiles","cid","pdbid","codid"])&&(a+="&"+Loader.lastQuery.type+"="+specialEncodeURIComponent(Loader.lastQuery.content.replace(/^ /,""))),"black"!==Model.bg.colorName&&(a+="&bg="+Model.bg.colorName),Model.isPDB()&&("ribbon"!==Model.chain.type&&"cylinders"!==Model.chain.type&&"btube"!==Model.chain.type&&"ctrace"!==Model.chain.type||(a+="&chainType="+Model.chain.type),Model.chain.bonds&&(a+="none"===Model.chain.type?"&chainType=bonds":"&chainBonds=true"),Model.chain.color&&(a+="&chainColor="+Model.chain.color)),Link.embedHTML='<iframe style="width: '+$("#embed-width").val()+"; height: "+$("#embed-height").val()+';" frameborder="0" src="'+a+'"></iframe>',$("#embed-code").val(Link.embedHTML),$("#embed-url").val(a)}},PubChemProps={formula:"MolecularFormula",mw:"MolecularWeight",donors:"HBondDonorCount",acceptors:"HBondAcceptorCount",sysname:"IUPACName",canonicalsmiles:"CanonicalSMILES",isomericsmiles:"IsomericSMILES",inchikey:"InChIKey",inchi:"InChI"},PubChemPropNames=["MolecularFormula","MolecularWeight","HBondDonorCount","HBondAcceptorCount","IUPACName","CanonicalSMILES","IsomericSMILES","InChIKey","InChI"],CIRProps={formula:"formula",mw:"mw",donors:"h_bond_donor_count",acceptors:"h_bond_acceptor_count",sysname:"iupac_name",canonicalsmiles:"smiles",inchikey:"stdinchikey",inchi:"stdinchi",cas:"cas",csid:"chemspider_id"},InfoCard={PubChem_cache:void 0,PubChem_queue:[],data:{},updated:!1,percentCompositionPrecision:5,update:function(a){return this.data.smiles!==a&&""!==a&&($(".chemprop").html("").val("").addClass("chemprop-loading"),$("#molecule-image").css("filter","url('#pubchemImageFilter'"),$("#molecule-image").attr("src",emptyImage),$("#molecule-image-wrapper").show(),$("#molecule-info").hide(),$("#molecule-title").text(""),$("#molecule-description").text(""),$("#percent-composition-table, #percent-composition-title").hide(),$("#common-chem-props tr").show(),$(".chem-identifier").show(),$(".chem-link").hide(),this.PubChem_cache=void 0,this.PubChem_queue=[],this.data={},this.data.smiles=a,this.data.cid=Sketcher.metadata.cid,this.data.inchikey=Sketcher.metadata.inchikey,this.data.inchi=Sketcher.metadata.inchi,this.updated=!1,!0)},load:function(){this.updated||(this.updated=!0,this.updateImage(),this.loadProperty("cid",function(a){a&&$("#pubchem-link").attr("href",Request.PubChem.staticURL(a)).show(),InfoCard.loadProperty("formula"),InfoCard.loadProperty("mw"),InfoCard.loadProperty("donors"),
InfoCard.loadProperty("acceptors"),InfoCard.loadProperty("sysname"),InfoCard.loadProperty("canonicalsmiles"),InfoCard.loadProperty("isomericsmiles",function(a){}),InfoCard.loadProperty("inchikey"),InfoCard.loadProperty("inchi",function(a){}),InfoCard.loadProperty("cas"),InfoCard.loadProperty("csid",function(a){a&&$("#chemspider-link").attr("href","http://www.chemspider.com/Chemical-Structure."+a+".html").show()}),a&&Request.PubChem.description(a,function(a){for(var b,c,d=0;d<a.InformationList.Information.length;d++)void 0===b&&void 0!==a.InformationList.Information[d].Title&&(b=ucfirst(humanize(a.InformationList.Information[d].Title))),void 0===c&&void 0!==a.InformationList.Information[d].Description&&(c=a.InformationList.Information[d].Description);document.title=b,$("#molecule-info").show(),$("#molecule-title").text(b),$("#molecule-description").text(c)})}))},processFormula:function(a){this.data.molecule={},regex=/((?:[A-Z][a-z]?))([\d,.]*)/g;for(var b;null!==(b=regex.exec(a));)this.data.molecule[b[1]]=parseFloat(b[2])||1;$("#percent-composition-title").show(),$("#percent-composition-table").empty().show();var c=0;return jQuery.each(this.data.molecule,function(a,b){c+=ElementsMolarTable[a]*b}),jQuery.each(this.data.molecule,function(a,b){$("#percent-composition-table").append("<tr>\t\t\t\t<td>"+a+"</td>\t\t\t\t<td>"+ElementsMolarTable[a]+" u &times; "+b+"</td>\t\t\t\t<td>"+(ElementsMolarTable[a]*b/c*100).toPrecision(InfoCard.percentCompositionPrecision)+" %</td>\t\t\t</tr>")}),formatMFormula(a)},updateImage:function(){if(""!==InfoCard.smiles){var a=new Image;a.onload=function(){$("#molecule-image").attr("src",a.src),$("#molecule-image").css("width",300/MolView.devicePixelRatio),$("#molecule-image-wrapper").show()},a.onerror=function(){$("#molecule-image").attr("src",emptyImage),$("#molecule-image-wrapper").hide()},Sketcher.metadata.cid?a.src=Request.PubChem.image(Sketcher.metadata.cid):a.src=Request.PubChem.smilesToImage(InfoCard.data.smiles)}},loadProperty:function(a,b){InfoCard.getProperty(a,function(c){"mw"===a&&(c+=" u");var d=$("#prop-"+a);d.is("input")?d.val(c).removeClass("chemprop-loading"):d.html(c).removeClass("chemprop-loading"),b&&b(c)},function(){$("#prop-"+a+"-wrapper").hide(),b&&b()})},getProperty:function(a,b,c){function d(){"isomericsmiles"===a?(InfoCard.data.isomericsmiles=InfoCard.data.smiles,b(InfoCard.data.isomericsmiles)):c&&c()}InfoCard.data[a]?b(InfoCard.data[a]):"cid"===a?Request.PubChem.smilesToCID(InfoCard.data.smiles,function(a){InfoCard.data.cid=a,b(InfoCard.data.cid)},function(){InfoCard.data.cid=-1,d()}):InfoCard.getPropertyFromPubChem(a,b,d)},getPropertyFromPubChem:function(a,b,c){InfoCard.data.cid===-1?InfoCard.getPropertyFromCIR(a,b,c):InfoCard.data.cid&&"cas"===a?Request.PubChem.casNumber(InfoCard.data.cid,function(a){InfoCard.data.cas=a,b(InfoCard.data.cas)},function(){InfoCard.getPropertyFromCIR(a,b,c)}):PubChemProps[a]?InfoCard.PubChem_cache?InfoCard.loadFrom_PubChem_cache(a,b,function(){InfoCard.getPropertyFromCIR(a,b,c)}):InfoCard.data.cid&&(InfoCard.PubChem_cache={loading:!0},Request.PubChem.properties(InfoCard.data.cid,PubChemPropNames,function(d){InfoCard.PubChem_cache=d.PropertyTable.Properties[0]||{failed:!0};for(var e=0;e<InfoCard.PubChem_queue.length;e++)InfoCard.PubChem_queue[e].success();InfoCard.PubChem_queue=[],InfoCard.loadFrom_PubChem_cache(a,b,function(){InfoCard.getPropertyFromCIR(a,b,c)})},function(){for(var d=0;d<InfoCard.PubChem_queue.length;d++)InfoCard.PubChem_queue[d].fail();InfoCard.PubChem_queue=[],InfoCard.PubChem_cache={failed:!0},InfoCard.getPropertyFromCIR(a,b,c)})):InfoCard.getPropertyFromCIR(a,b,c)},getPropertyFromCIR:function(a,b,c){InfoCard.data.smiles&&void 0!==CIRProps[a]?Request.CIR.property(InfoCard.data.isomericsmiles||InfoCard.data.smiles,CIRProps[a],function(c){"formula"===a?InfoCard.data.formula=InfoCard.processFormula(c):"sysname"===a?InfoCard.data.sysname=humanize(c):InfoCard.data[a]=c,b(InfoCard.data[a])},c):c()},loadFrom_PubChem_cache:function(a,b,c){function d(a){return void 0!==InfoCard.PubChem_cache[PubChemProps[a]]&&("formula"===a?InfoCard.data[a]=InfoCard.processFormula(InfoCard.PubChem_cache[PubChemProps[a]]):InfoCard.data[a]=InfoCard.PubChem_cache[PubChemProps[a]],!0)}!InfoCard.PubChem_cache||InfoCard.PubChem_cache.failed?c():InfoCard.PubChem_cache.loading?InfoCard.PubChem_queue.push({success:function(){d(a)?b(InfoCard.data[a]):c()},fail:c}):d(a)?b(InfoCard.data[a]):c()}},Spectroscopy={data:{},spectrum:void 0,spectrumRatio:1/.3,init:function(){$(window).on("resize",function(){$("#spectra-layer").is(":visible")&&Spectroscopy.resize()}),$("#spectrum-select").on("change",function(){Spectroscopy.load($("#spectrum-select").val())}),MolView.mobile?($("#spectrum-wrapper").on("touchmove",function(a){a.stopImmediatePropagation()}),this.spectrum_ratio=2,this.spectrum=new ChemDoodle.ObserverCanvas("spectrum-canvas",100,100)):this.spectrum=new ChemDoodle.SeekerCanvas("spectrum-canvas",100,100,ChemDoodle.SeekerCanvas.SEEK_PLOT),this.spectrum.specs.plots_showYAxis=!0,this.spectrum.specs.plots_flipXAxis=!0,this.spectrum.specs.plots_showGrid=!0,this.spectrum.specs.backgroundColor="#ffffff",this.spectrum.emptyMessage="No spectrum selected"},update:function(a){function b(){$("#spectrum-select").empty(),$("#spectrum-select").append('<option value="default" disabled selected style="display:none;">There are no spectra available</option>'),$("#spectrum").removeClass("loading")}this.data={},InfoCard.update(a),$("#spectrum-nist-source").hide(),$("#spectrum").addClass("loading"),$("#spectrum-select").html('<option value="loading" selected>Loading&hellip;</option>').val("loading"),this.print("No spectrum selected"),InfoCard.getProperty("cas",function(a){Spectroscopy.data.cas=a,Request.NIST.lookup(Spectroscopy.data.cas,function(a){if($("#spectrum-select").empty(),$("#spectrum-select").append('<option value="default" disabled selected style="display:none;">Choose a spectrum</option>'),a.mass&&$("#spectrum-select").append('<option value="nist-mass">Mass spectrum</option>'),void 0!==a.ir)for(var b=0;b<a.ir.length;b++)$("#spectrum-select").append('<option value="nist-ir-'+a.ir[b].i+'">IR spectrum ['+a.ir[b].state+"]</option>");(a.mass||void 0!==a.ir&&a.ir.length>0)&&$("#spectrum-nist-source").attr("href",a.url).show(),$("#spectrum").removeClass("loading")},b)},b)},load:function(a){function b(){var a=ChemDoodle.readJCAMP(Spectroscopy.data.nmrdb);a.title=ucfirst(humanize(a.title)),a.yUnit=ucfirst(humanize(a.yUnit)),Spectroscopy.spectrum.specs.plots_flipXAxis=!0,Spectroscopy.spectrum.loadSpectrum(a),$("#spectrum").removeClass("loading")}function c(){var b=ChemDoodle.readJCAMP(Spectroscopy.data[a]);b.title=ucfirst(humanize(b.title)),b.yUnit=ucfirst(humanize(b.yUnit)),"nist-mass"===a?Spectroscopy.spectrum.specs.plots_flipXAxis=!1:Spectroscopy.spectrum.specs.plots_flipXAxis=!0,Spectroscopy.spectrum.loadSpectrum(b),$("#spectrum").removeClass("loading")}this.print("Loadingâ€¦"),$("#spectrum").addClass("loading"),"nmrdb"===a?this.data.nmrdb?b():InfoCard.getProperty("smiles",function(a){Request.NMRdb.prediction(a,function(a){Spectroscopy.data.nmrdb=a,b()},function(){Spectroscopy.print("Spectrum unavailable")})}):a.indexOf(!0)&&(Spectroscopy.data[a]?c():Request.NIST.spectrum(this.data.cas,a.substr(5),function(b){Spectroscopy.data[a]=b,c()},function(){Spectroscopy.print("Spectrum unavailable")}))},print:function(a){Spectroscopy.spectrum.emptyMessage=a,Spectroscopy.spectrum.loadSpectrum(null)},resize:function(){var a=$("#spectrum-wrapper").width(),b=Math.round(a/Spectroscopy.spectrumRatio);Spectroscopy.spectrum.resize(a*MolView.devicePixelRatio,b*MolView.devicePixelRatio),$("#spectrum-canvas").css({width:a*MolView.devicePixelRatio,height:b*MolView.devicePixelRatio})}};AutocompleteBuilder.prototype.sort=function(a,b,c){a=a.toLowerCase();for(var d=this.array.slice(0),e=0;e<d.length;e++)d[e].similarity=similar_text(a,d[e][this.key].toLowerCase(),!0),0===d[e][this.key].toLowerCase().indexOf(a)&&(d[e].similarity+=100),b&&d[e].similarity<b&&(d.splice(e,1),e--);return d.sort(function(a,b){return b.similarity-a.similarity}).slice(0,c?c:d.length)};var Autocomplete={MIN_SIM:40,MAX_NUMBER:10,minLength:1,maxLength:32,maxResults:20,macromolecules:void 0,minerals:void 0,oldText:"",cache:{},records:[],i:-1,init:function(){for(var a=0;a<PDBNames.macromolecules.length;a++)PDBNames.macromolecules[a].label=PDBNames.macromolecules[a].name;for(var a=0;a<MineralNames.records.length;a++)MineralNames.records[a].label=ucfirst(MineralNames.records[a].name);this.macromolecules=new AutocompleteBuilder(PDBNames.macromolecules,"name"),this.minerals=new AutocompleteBuilder(MineralNames.records,"name"),$("#search-input")[0].addEventListener("input",Autocomplete.refresh.bind(Autocomplete)),$("#search-input").on("keydown",Autocomplete.keydown.bind(Autocomplete)),$("#search").on("submit",function(a){a.preventDefault(),Autocomplete.submit()}),$("#search-input").on("focus",function(){this.select(),Autocomplete.focus()}),$(window).on(MolView.trigger,function(a){var b=$("#search-input, #autocomplete-dropdown");b.is(a.target)||0!==b.has(a.target).length||Autocomplete.hide()}),$(window).on("blur",Autocomplete.hide)},focusRecord:function(a){a>-1&&a<Autocomplete.records.length&&$("#search-input").val(Autocomplete.records[a].label),$(".autocomplete-item").removeClass("autocomplete-item-active");var b=$(".autocomplete-item").eq(a);if(a!==-1){b.addClass("autocomplete-item-active");var c=b.position();c.top+b.outerHeight()>$("#autocomplete-dropdown").outerHeight()?$("#autocomplete-dropdown").scrollTop($("#autocomplete-dropdown").scrollTop()-$("#autocomplete-dropdown").outerHeight()+c.top+b.outerHeight()):c.top<0&&$("#autocomplete-dropdown").scrollTop($("#autocomplete-dropdown").scrollTop()+c.top)}},keydown:function(a){this.i===-1&&(this.oldText=$("#search-input").val());var b=a.keyCode||a.which;switch(b){case 27:return this.hide(),$("#search-input").blur(),!0;case 38:return this.i--,this.i===-1?$("#search-input").val(this.oldText):this.i<-1&&(this.i=this.records.length-1),this.focusRecord(this.i),!0;case 40:return this.i++,this.i>=this.records.length&&(this.i=0),this.focusRecord(this.i),!0;case 39:if(document.getElementById("search-input").selectionStart===$("#search-input").val().length){var c=this.records.filter(function(a){return 0===a.name.toLowerCase().indexOf($("#search-input").val().toLowerCase())});return c.length>0&&$("#search-input").val(c[0].label),!0}}},refresh:function(){var a=$("#search-input").val().toLowerCase();if(Autocomplete.cache[a])Autocomplete.display(Autocomplete.cache[a]);else{if(a.length>Autocomplete.maxLength)return;if(a.length<Autocomplete.minLength)Autocomplete.display([]);else{var b=[];b=!MolView.macromolecules||!Detector.webgl&&MolView.mobile?this.minerals.sort(a,this.MIN_SIM,this.MAX_NUMBER).slice(0):this.macromolecules.sort(a,this.MIN_SIM,this.MAX_NUMBER).slice(0).concat(this.minerals.sort(a,this.MIN_SIM,this.MAX_NUMBER).slice(0)),this.getPubChemAutocomplete(a,function(c){for(var d=0;d<c.length;d++)c[d].label=ucfirst(humanize(c[d].name));b=b.concat(c),b=new AutocompleteBuilder(b,"label").sort(a);for(var d=0;d<b.length;d++)d<b.length-1&&b[d].label===b[d+1].label&&(b[d].codid=b[d].codid||b[d+1].codid,b[d].PubChem_name=b[d].PubChem_name||b[d+1].PubChem_name,b.splice(d+1,1));Autocomplete.cache[a]=b,a===$("#search-input").val().toLowerCase()&&Autocomplete.display(Autocomplete.cache[a])})}}},display:function(a){Autocomplete.records=a,Autocomplete.i=-1,$("#autocomplete-dropdown").empty();for(var b=$("<ul></ul>"),c=$("#search-input").val().toLowerCase(),d=0;d<a.length;d++){var e=$('<li class="autocomplete-item"></li>');0===a[d].label.toLowerCase().indexOf(c)?$('<span class="autocomplete-label"></span>').html("<b>"+a[d].label.substr(0,c.length)+"</b>"+a[d].label.substr(c.length)).appendTo(e):$('<span class="autocomplete-label"></span>').html(a[d].label).appendTo(e),a[d].pdbids?(e.addClass("autocomplete-macromolecule"),$('<span class="autocomplete-type"></span>').html(PDBNames.types[a[d].type]).appendTo(e)):a[d].codid?(e.addClass("autocomplete-mineral"),$('<span class="autocomplete-type"></span>').html("Mineral").appendTo(e)):(e.addClass("autocomplete-pubchem"),$('<span class="autocomplete-type"></span>').html("Compound").appendTo(e)),$('<div style="clear: both;"></div>').appendTo(e),e.data("i",d),e.on(MolView.trigger,function(){Autocomplete.i=$(this).data("i"),Autocomplete.submit()}),b.append(e)}$("#autocomplete-dropdown").append(b),a.length>0?$("#autocomplete-dropdown").show():$("#autocomplete-dropdown").hide()},focus:function(){Autocomplete.i=-1,$(".autocomplete-item").removeClass("autocomplete-item-active"),$("#autocomplete-dropdown-wrapper").show(),$("#autocomplete-dropdown").hide(),$("#menu").scrollLeft($("#brand").is(":visible")?55:0)},hide:function(){$("#autocomplete-dropdown-wrapper").hide()},submit:function(){if(MolView.pushEvent("input","submit","autocomplete",0),""===$("#search-input").val())$("#search-input").focus(),MolView.alertEmptyInput();else{if(this.hide(),$("#search-input").blur(),MolView.hideDialogs(),MolView.setLayer("main"),this.i===-1)for(var a=0;a<this.records.length;a++)if(this.records[a].name.toLowerCase()==$("#search-input").val().toLowerCase()){this.i=a;break}if(this.i===-1){var b=$("#search-input").val();void 0===Autocomplete.cache[b]?Loader.PubChem.loadName(b,!0):Messages.process(Loader.CIRsearch,"search")}else $("#search-input").val(this.records[this.i].label),this.records[this.i].pdbids?Loader.RCSB.loadPDBID(this.records[this.i].pdbids[0],this.records[this.i].label):this.records[this.i].codid?Loader.COD.loadCODID(this.records[this.i].codid,this.records[this.i].label,this.records[this.i].PubChem_name):Loader.PubChem.loadName(this.records[this.i].label),this.refresh()}},getPubChemAutocomplete:function(a,b){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/pcautocp/pcautocp.cgi?dict=pc_compoundnames&n="+this.MAX_NUMBER+"&q="+a,success:function(a){for(var c=[],d=0;d<a.autocp_array.length;d++)c.push({name:a.autocp_array[d],PubChem_name:a.autocp_array[d]});b(c)}})}},MolView={layout:"",touch:!1,mobile:!1,devicePixelRatio:1,trigger:"click",query:{},loadDefault:!0,macromolecules:!0,JMOL_J2S_PATH:"jmol/j2s",init:function(){window.onerror=function(a,b,c,d){ga("send","exception",{exDescription:b+" "+c+","+d+": "+a,exFatal:!1})},$(document).ajaxError(function(a,b,c){ga("send","exception",{exDescription:"AJAX error: "+c.type+" "+c.url+": "+b.statusText,exFatal:!1})}),MolView.devicePixelRatio=window.devicePixelRatio||(MolView.mobile?1.5:1),Preferences.init(),Progress.init(),History.init(),Link.init(),Model.preloadQuery(this.query),(this.query.q||this.query.smiles||this.query.cid||this.query.pdbid||this.query.codid)&&(this.loadDefault=!1),Spectroscopy.init(),Autocomplete.init(),Request.init(),Sketcher.init(),SearchGrid.init(),this.touch&&!Detector.webgl&&(this.macromolecules=!1,Model.JSmol.setQuality(!1)),this.height=window.innerHeight,$(".dropdown-menu").css("max-height",$("#content").height()-10),$("#main-layer").saveSize(),$(window).on("resize",function(){$(".dropdown-menu").css("max-height",$("#content").height()-10),MolView.setMenuLayout($(window).width()<1100,$(window).width()<1100&&!MolView.touch,$(window).width()<390&&MolView.touch),Progress.resize(),$("#main-layer").is(":hidden")||($("#main-layer").saveSize(),Sketcher.resize(),Model.resize())}),$(".dropdown-toggle").on(this.trigger,function(a){a.stopPropagation(),Autocomplete.hide(),$(".dropdown-toggle").not(this).parent().removeClass("open"),$("#menu").toggleClass("menu-open",$(this).parent().toggleClass("open").hasClass("open")).scrollTop(0)}),this.touch||$(".dropdown-toggle").hover(function(a){$("#menu").hasClass("menu-open")&&(a.stopPropagation(),$(".dropdown").removeClass("open"),$(this).parent().addClass("open"))},function(){}),$(".dropdown-menu a").on(this.trigger,function(a){$(this).hasClass("disabled")?a.stopImmediatePropagation():($(".dropdown-toggle").not(this).parent().removeClass("open"),$("#menu").removeClass("menu-open"))}),$(window).on(this.trigger,function(a){var b=$(".dropdown.open .dropdown-menu"),c=$("#search-input");b.is(a.target)||0!==b.has(a.target).length||(a.stopPropagation(),$("#menu").removeClass("menu-open"),$(".dropdown").removeClass("open")),c.is(a.target)||0!==c.has(a.target).length||"search-input"!==document.activeElement.id||$("#search-input").blur()}),$("#dialog-click-area").on("mousedown",function(a){var b=a.target||a.srcElement;"Range"===window.getSelection().type||$(document.activeElement).is("input")||($(b).is(this)||$(b).is("#dialog-wrapper"))&&(MolView.hideDialogs(),window.getSelection().removeAllRanges())}),$(".dialog .btn.close, .dialog-close-btn").on(this.trigger,function(a){MolView.hideDialogs()}),$(".layer .btn.close").on(this.trigger,function(a){MolView.setLayer("main")}),$(".expandable-title").on(this.trigger,function(a){$(this).parent().toggleClass("open")}),$("#allow-tracking").on("change",function(){Preferences.set("molview","allow_tracking",this.checked)}),this.addAction("layout_sketcher","menu",!0),this.addAction("layout_model","menu",!0),this.addAction("layout_vsplit","menu",!0),this.addAction("layout_hsplit","menu",!0),this.addAction("theme_desktop","menu",!0),this.addAction("theme_touch","menu",!0),this.addAction("help","menu",!0),this.addAction("about","menu",!0),this.addAction("share","menu",!0),this.addAction("embed","menu",!0),this.addAction("export_sketcher_png","menu",!0),this.addAction("export_model_png","menu",!0),this.addAction("export_model","menu",!0),this.addAction("data_infocard","menu",!0),this.addAction("data_spectra","menu",!0),this.addAction("search_substructure","menu",!0),this.addAction("search_superstructure","menu",!0),this.addAction("search_similarity","menu",!0),this.addAction("model_reset","menu",!0),this.addAction("model_balls","menu",!0),this.addAction("model_stick","menu",!0),this.addAction("model_vdw","menu",!0),this.addAction("model_wireframe","menu",!0),this.addAction("model_line","menu",!0),this.addAction("model_bg_black","menu",!0),this.addAction("model_bg_gray","menu",!0),this.addAction("model_bg_white","menu",!0),this.addAction("engine_glmol","menu",!0),this.addAction("engine_jmol","menu",!0),this.addAction("engine_cdw","menu",!0),this.addAction("cif_unit_cell","menu",!0),this.addAction("cif_cubic_supercell","menu",!0),this.addAction("cif_flat_supercell","menu",!0),this.addAction("bio_assembly","menu",!0),this.addAction("chain_type_ribbon","menu",!0),this.addAction("chain_type_cylinders","menu",!0),this.addAction("chain_type_btube","menu",!0),this.addAction("chain_type_ctrace","menu",!0),this.addAction("chain_type_bonds","menu",!0),this.addAction("chain_color_ss","menu",!0),this.addAction("chain_color_spectrum","menu",!0),this.addAction("chain_color_chain","menu",!0),this.addAction("chain_color_residue","menu",!0),this.addAction("chain_color_polarity","menu",!0),this.addAction("chain_color_bfactor","menu",!0),this.addAction("jmol_hq","menu",!0),this.addAction("jmol_clean","menu",!0),this.addAction("jmol_mep_lucent","menu",!0),this.addAction("jmol_mep_opaque","menu",!0),this.addAction("jmol_charge","menu",!0),this.addAction("jmol_bond_dipoles","menu",!0),this.addAction("jmol_net_dipole","menu",!0),this.addAction("jmol_minimize","menu",!0),this.addAction("jmol_measure_distance","menu",!0),this.addAction("jmol_measure_angle","menu",!0),this.addAction("jmol_measure_torsion","menu",!0),this.addAction("search_pubchem","menu",!0),this.addAction("search_rcsb","menu",!0),this.addAction("search_cod","menu",!0),this.addAction("show_search_layer","menu",!0),this.addAction("load_more_pubchem","button",!0),this.addAction("load_more_rcsb","button",!0),this.addAction("load_more_cod","button",!0),this.addAction("mp_bond_single","button",!0),this.addAction("mp_bond_double","button",!0),this.addAction("mp_bond_triple","button",!0),this.addAction("mp_bond_wedge","button",!0),this.addAction("mp_bond_hash","button",!0),this.addAction("mp_frag_benzene","button",!0),this.addAction("mp_frag_cyclopropane","button",!0),this.addAction("mp_frag_cyclobutane","button",!0),this.addAction("mp_frag_cyclopentane","button",!0),this.addAction("mp_frag_cyclohexane","button",!0),this.addAction("mp_frag_cycloheptane","button",!0),this.addAction("mp_chain","button",!0),this.addAction("mp_charge_add","button",!0),this.addAction("mp_charge_sub","button",!0),this.addAction("mp_clear","button",!0),this.addAction("mp_eraser","button",!0),this.addAction("mp_drag","button",!0),this.addAction("mp_undo","button",!0),this.addAction("mp_redo","button",!0),this.addAction("mp_rect","button",!0),this.addAction("mp_lasso","button",!0),this.addAction("mp_color_mode","button",!0),this.addAction("mp_skeletal_formula","button",!0),this.addAction("mp_center","button",!0),this.addAction("mp_clean","button",!0),this.addAction("mp_atom_c","button",!0),this.addAction("mp_atom_h","button",!0),this.addAction("mp_atom_n","button",!0),this.addAction("mp_atom_o","button",!0),this.addAction("mp_atom_p","button",!0),this.addAction("mp_atom_s","button",!0),this.addAction("mp_atom_f","button",!0),this.addAction("mp_atom_cl","button",!0),this.addAction("mp_atom_br","button",!0),this.addAction("mp_atom_i","button",!0),this.addAction("mp_periodictable","button",!0),this.addAction("resolve","button",!0),this.addAction("start_help","button",!0),this.addAction("export_spectrum_png","button",!0),this.addAction("export_spectrum_jcamp","button",!0),$("#welcome-loading-msg").hide(),$("#welcome-button-bar").show(),$("#model-source").on(this.trigger,function(){MolView.pushEvent("link","click","model source",0)}),$("#spectrum-nist-source").on(this.trigger,function(){MolView.pushEvent("link","click","spectrum nist source",0)}),Model.init(function(){MolView.executeQuery(),Sketcher.markUpdated(),Request.CIR.available||Messages.alert("cir_down")},"GLmol")},addAction:function(a,b,c){$("#action-"+a.replace(/_/g,"-")).on(this.trigger,function(d){$(this).hasClass("disabled")||$(this).hasClass("tool-button-disabled")||(c&&Preferences.get("molview","allow_tracking",!1)?MolView.pushEvent(b,"click",a.replace(/_/g," "),Actions[a].call(this)||0):Actions[a].call(this))})},pushEvent:function(a,b,c,d){ga("send","event",a,b,c,d)},executeQuery:function(){$.each(this.query,function(a,b){"q"===a?($("#search-input").val(b),Messages.process(Loader.CIRsearch,"search")):"smiles"===a?Messages.process(function(){Loader.loadSMILES(b,document.title)},"compound"):"cid"===a?Loader.PubChem.loadCID(b,document.title):"pdbid"===a?Loader.RCSB.loadPDBID(b,b.toUpperCase()):"codid"===a?Loader.COD.loadCODID(b,document.title):"dialog"===a?MolView.showDialog(b):"bg"===a&&Model.setBackground(b)})},showDialog:function(a){$("#dialog-overlay .dialog").hide(),$("#dialog-overlay").show(),$("#dialog-overlay").scrollTop(0),$("#"+a+"-dialog").show()},hideDialogs:function(){$("#dialog-overlay .dialog").hide(),$("#dialog-overlay").hide()},setLayer:function(a,b){$(".layer").hide(),$("#"+a+"-layer").show(),"main"===a&&($("#main-layer").sizeChanged()||b)&&($("#main-layer").saveSize(),Sketcher.resize(),Model.resize())},setLayout:function(a){$("#layout-menu > a").removeClass("selected"),$("#action-layout-"+a).addClass("selected"),$("#main-layer").removeClass("layout-sketcher layout-model layout-vsplit layout-hsplit").addClass("layout-"+a),this.layout=a,this.setLayer("main",!0)},setMenuLayout:function(a,b,c){$("#search").css("margin",b?0:""),$("#search-input").css("width",b?100:c?$(window).width()-90:""),$("#brand").toggle(!b),$("#search-dropdown .dropdown-menu").toggleClass("dropdown-left",$(window).width()>=$("#search-dropdown .dropdown-menu").outerWidth()&&!b).toggleClass("dropdown-compact",a),$("#jmol-dropdown .dropdown-menu, #protein-dropdown .dropdown-menu").toggleClass("dropdown-left",a)},setTheme:function(a){Preferences.set("molview","theme",a),$("#action-theme-desktop, #action-theme-touch").removeClass("checked"),$("#action-theme-"+a).addClass("checked"),$("#theme-stylesheet").attr("href","build/molview-"+a+".min.css")},makeModelVisible:function(){"sketcher"===this.layout&&MolView.setLayout("both")},alertEmptyInput:function(){null!==MolView.search_input_timeout&&window.clearTimeout(MolView.search_input_timeout),window.setTimeout(function(){$("#search-input").addClass("alert").focus()},0),MolView.search_input_timeout=window.setTimeout(function(){$("#search-input").removeClass("alert")},1e3)},search_input_timeout:null};$(window).on("load",function(){MolView.init()});