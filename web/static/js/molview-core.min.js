/*! MolView JavaScript Core build on 2017-02-26 */
function ucfirst(a){return void 0===a?a:a.charAt(0).toUpperCase()+a.slice(1)}function humanize(a){return void 0===a?a:a.replace(/(\b[A-Z]+\b)/g,function(a){return a.toLowerCase()})}function formatMFormula(a){return a?a.replace(/[a-zA-Z0-9.,]+/g,function(a){return ChemIdentifiers.isFormula(a)?a.replace(/[\d,.]*/g,"<sub>$&</sub>"):a}):void 0}function formatHTMLLinks(a){return a.replace(/(http|https):\/\/[^\s]+/g,function(a){return'<a class="link" href="'+a+'" target="_blank">'+a+"</a>"})}function isTouchDevice(){return!!("ontouchstart"in window)||!!("onmsgesturechange"in window)&&!!window.navigator.maxTouchPoints}function getQuery(){if(""===location.search)return{};var a=location.search.slice(1).split("&"),b={};return a.forEach(function(a){a=a.split(/=(.+)?/),b[a[0]]=decodeURIComponent(a[1]||"")}),b}function oneOf(a,b){return b.indexOf(a)!==-1}function specialEncodeURIComponent(a){return a.replace(/&/g,"%26").replace(/#/g,"%23")}function dataURItoBlob(a){try{for(var b=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new ArrayBuffer(b.length),e=new Uint8Array(d),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);var g=new DataView(d),h=new Blob([g],{type:c});return h}catch(a){return console.error(a),null}}function openDataURI(a){var b=dataURItoBlob(a),c=window.URL||window.webkitURL||void 0;null!==b&&void 0!==c?window.open(c.createObjectURL(b)):window.open(a)}function AJAX(a){return a.primary&&void 0!==xhr&&xhr.abort(),void 0!==a.defaultError&&(a.error=function(b,c){"error"===c&&a.defaultError(b.status)}),a.primary?xhr=$.ajax(a):$.ajax(a)}function similar_text(a,b,c){if(null===a||null===b||"undefined"==typeof a||"undefined"==typeof b)return 0;a+="",b+="";var d,e,f,g,h=0,i=0,j=0,k=a.length,l=b.length;for(j=0,d=0;d<k;d++)for(e=0;e<l;e++){for(f=0;d+f<k&&e+f<l&&a.charAt(d+f)===b.charAt(e+f);f++);f>j&&(j=f,h=d,i=e)}return g=j,g&&(h&&i&&(g+=this.similar_text(a.substr(0,h),b.substr(0,i))),h+j<k&&i+j<l&&(g+=this.similar_text(a.substr(h+j,k-h-j),b.substr(i+j,l-i-j)))),c?200*g/(k+l):g}function getISOLanguageCode(a){return a.indexOf(";")!==-1&&(a=a.substr(0,a.indexOf(";"))),a.indexOf("-")!==-1&&(a=a.substr(0,a.indexOf("-"))),a.indexOf("_")!==-1&&(a=a.substr(0,a.indexOf("_"))),a}var emptyImage="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",defaultMol2D=["C8H10N4O2","APtclcactv04181408232D 0   0.00000     0.00000"," "," 24 25  0  0  0  0  0  0  0  0999 V2000","    2.8660    0.5000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    2.0000    1.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.8660   -0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.0000   -1.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -1.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -2.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    4.5981   -0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    5.5443   -0.8047    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    6.1279    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    5.5443    0.8047    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    5.8550    1.7553    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    4.5981    0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321    1.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321    2.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0","    2.3100    1.5369    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    1.4631    1.3100    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    1.6900    0.4631    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.1121   -2.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -2.6200    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    4.3521   -2.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.7479   -0.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.4443    1.5626    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.0476    2.3446    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    5.2656    1.9479    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","  1  2  1  0  0  0  0","  1  3  1  0  0  0  0","  3  4  2  0  0  0  0","  3  5  1  0  0  0  0","  5  6  1  0  0  0  0","  5  7  1  0  0  0  0","  7  8  1  0  0  0  0","  8  9  2  0  0  0  0","  9 10  1  0  0  0  0"," 10 11  1  0  0  0  0"," 10 12  1  0  0  0  0","  7 12  2  0  0  0  0"," 12 13  1  0  0  0  0","  1 13  1  0  0  0  0"," 13 14  2  0  0  0  0","  2 15  1  0  0  0  0","  2 16  1  0  0  0  0","  2 17  1  0  0  0  0","  6 18  1  0  0  0  0","  6 19  1  0  0  0  0","  6 20  1  0  0  0  0","  9 21  1  0  0  0  0"," 11 22  1  0  0  0  0"," 11 23  1  0  0  0  0"," 11 24  1  0  0  0  0","M  END","$$$$"].join("\n"),defaultMol3D=["2519","  -OEChem-10201411173D",""," 24 25  0     0  0  0  0  0  0999 V2000","    0.4700    2.5688    0.0006 O   0  0  0  0  0  0  0  0  0  0  0  0","   -3.1271   -0.4436   -0.0003 O   0  0  0  0  0  0  0  0  0  0  0  0","   -0.9686   -1.3125    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    2.2182    0.1412   -0.0003 N   0  0  0  0  0  0  0  0  0  0  0  0","   -1.3477    1.0797   -0.0001 N   0  0  0  0  0  0  0  0  0  0  0  0","    1.4119   -1.9372    0.0002 N   0  0  0  0  0  0  0  0  0  0  0  0","    0.8579    0.2592   -0.0008 C   0  0  0  0  0  0  0  0  0  0  0  0","    0.3897   -1.0264   -0.0004 C   0  0  0  0  0  0  0  0  0  0  0  0","    0.0307    1.4220   -0.0006 C   0  0  0  0  0  0  0  0  0  0  0  0","   -1.9061   -0.2495   -0.0004 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.5032   -1.1998    0.0003 C   0  0  0  0  0  0  0  0  0  0  0  0","   -1.4276   -2.6960    0.0008 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.1926    1.2061    0.0003 C   0  0  0  0  0  0  0  0  0  0  0  0","   -2.2969    2.1881    0.0007 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.5163   -1.5787    0.0008 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.0451   -3.1973   -0.8937 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.5186   -2.7596    0.0011 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.0447   -3.1963    0.8957 H   0  0  0  0  0  0  0  0  0  0  0  0","    4.1992    0.7801    0.0002 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.0468    1.8092   -0.8992 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.0466    1.8083    0.9004 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.8087    3.1651   -0.0003 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.9322    2.1027    0.8881 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.9346    2.1021   -0.8849 H   0  0  0  0  0  0  0  0  0  0  0  0","  1  9  2  0  0  0  0","  2 10  2  0  0  0  0","  3  8  1  0  0  0  0","  3 10  1  0  0  0  0","  3 12  1  0  0  0  0","  4  7  1  0  0  0  0","  4 11  1  0  0  0  0","  4 13  1  0  0  0  0","  5  9  1  0  0  0  0","  5 10  1  0  0  0  0","  5 14  1  0  0  0  0","  6  8  1  0  0  0  0","  6 11  2  0  0  0  0","  7  8  2  0  0  0  0","  7  9  1  0  0  0  0"," 11 15  1  0  0  0  0"," 12 16  1  0  0  0  0"," 12 17  1  0  0  0  0"," 12 18  1  0  0  0  0"," 13 19  1  0  0  0  0"," 13 20  1  0  0  0  0"," 13 21  1  0  0  0  0"," 14 22  1  0  0  0  0"," 14 23  1  0  0  0  0"," 14 24  1  0  0  0  0","M  END","> <PUBCHEM_COMPOUND_CID>","2519","","> <PUBCHEM_CONFORMER_RMSD>","0.4","","> <PUBCHEM_CONFORMER_DIVERSEORDER>","1","","> <PUBCHEM_MMFF94_PARTIAL_CHARGES>","15","1 -0.57","10 0.69","11 0.04","12 0.3","13 0.26","14 0.3","15 0.15","2 -0.57","3 -0.42","4 0.05","5 -0.42","6 -0.57","7 -0.24","8 0.29","9 0.71","","> <PUBCHEM_EFFECTIVE_ROTOR_COUNT>","0","","> <PUBCHEM_PHARMACOPHORE_FEATURES>","5","1 1 acceptor","1 2 acceptor","3 4 6 11 cation","5 4 6 7 8 11 rings","6 3 5 7 8 9 10 rings","","> <PUBCHEM_HEAVY_ATOM_COUNT>","14","","> <PUBCHEM_ATOM_DEF_STEREO_COUNT>","0","","> <PUBCHEM_ATOM_UDEF_STEREO_COUNT>","0","","> <PUBCHEM_BOND_DEF_STEREO_COUNT>","0","","> <PUBCHEM_BOND_UDEF_STEREO_COUNT>","0","","> <PUBCHEM_ISOTOPIC_ATOM_COUNT>","0","","> <PUBCHEM_COMPONENT_COUNT>","1","","> <PUBCHEM_CACTVS_TAUTO_COUNT>","1","","> <PUBCHEM_CONFORMER_ID>","000009D700000001","","> <PUBCHEM_MMFF94_ENERGY>","22.901","","> <PUBCHEM_FEATURE_SELFOVERLAP>","25.487","","> <PUBCHEM_SHAPE_FINGERPRINT>","10967382 1 18338799025773621285","11132069 177 18339075025094499008","12524768 44 18342463625094026902","13140716 1 17978511158789908153","16945 1 18338517550775811621","193761 8 15816500986559935910","20588541 1 18339082691204868851","21501502 16 18338796715286957384","22802520 49 18128840606503503494","2334 1 18338516344016692929","23402539 116 18270382932679789735","23552423 10 18262240993325675966","23559900 14 18199193898169584358","241688 4 18266458702623303353","2748010 2 18266180539182415717","5084963 1 17698433339235542986","528886 8 18267580380709240570","53812653 166 18198902694142226312","66348 1 18339079396917369615","","> <PUBCHEM_SHAPE_MULTIPOLES>","256.45","4.01","2.83","0.58","0.71","0.08","0","-0.48","0","-0.81","0","0.01","0","0","","> <PUBCHEM_SHAPE_SELFOVERLAP>","550.88","","> <PUBCHEM_SHAPE_VOLUME>","143.9","","> <PUBCHEM_COORDINATE_TYPE>","2","5","10","","$$$$",""].join("\n"),ChemIdentifiers={regex:{formula:/^((?:[A-Z][a-z]?)+[\d,.]*)*/},isFormula:function(a){return this.regex.formula.exec(a)[0]===a}};!function(a){a.fn.textfill=function(b){var c,d,e=b.maxFontPoints,f=this.children(),g=a(this).height(),h=a(this).width();do f.css("font-size",""+e+"pt"),c=f.outerHeight(),d=f.outerWidth(),e-=1;while((c>g||d>h)&&e>6);return this}}(jQuery),function(a){$.fn.sizeChanged=function(){return!(this.data("savedWidth")===this.width()&&this.data("savedHeight")===this.height())},$.fn.saveSize=function(){this.data("savedWidth",this.width()),this.data("savedHeight",this.height())}}(jQuery);var xhr,Preferences={init:function(){void 0===Storage&&(window.localStorage={})},get:function(a,b,c){var d=window.localStorage[a+"."+b];return"true"===d||"false"!==d&&(d||c)},set:function(a,b,c){window.localStorage[a+"."+b]=c}},Progress={value:0,steps:0,oldTime:0,animValue:0,valueAnimDev:.2,opacity:0,opacityAnimSpeed:1,ready:!0,animReady:!0,resetAnim:!1,canvas:void 0,ctx:void 0,init:function(){this.canvas=document.getElementById("progress-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.resize(),this.draw())},resize:function(){Progress.canvas&&(Progress.canvas.width=$(window).width(),Progress.canvas.height=3)},draw:function(a){if(Progress.canvas){if(Progress.resetAnim&&(Progress.resetAnim=!1,Progress.animReady=!1,Progress.oldTime=a,Progress.animValue=0,Progress.opacity=1,Progress.ctx.clearRect(0,0,Progress.canvas.width,Progress.canvas.height)),!Progress.animReady){var b=(a-Progress.oldTime)/1e3||.001;b>.1&&(b=.1),Progress.oldTime=a,Progress.animValue+=(Progress.value-Progress.animValue)/(Progress.valueAnimDev/b),Progress.animValue>Progress.value&&(Progress.animValue=Progress.value),Progress.ctx.beginPath(),Progress.ready?(Progress.opacity-=Progress.opacityAnimSpeed*b,Progress.ctx.clearRect(0,0,Progress.canvas.width,Progress.canvas.height),Progress.opacity<=0?Progress.animReady=!0:(Progress.ctx.fillStyle="rgba(255,0,0,"+Progress.opacity+")",Progress.ctx.fillRect(0,0,Progress.canvas.width*Progress.animValue,Progress.canvas.height))):(Progress.ctx.fillStyle="rgb(255,0,0)",Progress.ctx.fillRect(0,0,Progress.canvas.width*Progress.animValue,Progress.canvas.height))}requestAnimationFrame(Progress.draw)}},reset:function(a,b){this.steps=a+1,this.value=0,this.increment(),this.ready=!1,b||(document.title=document.title.replace(/ \[loading\]/g,""),document.title+=" [loading]"),this.resetAnim=!0},increment:function(){this.value+=1/this.steps},complete:function(){this.value=1,this.ready=!0,document.title=document.title.replace(/ \[loading\]/g,"")}},Messages={cir_down:"The Chemical Identifier Resolver is offline, some functions might be unavailable.",cir_func_down:"This function is unavailable because the Chemical Identifier Resolver is offline.",crystal_2d_unreliable:"The structural formula might not fully represent the crystal structure",resolved_3d_unreliable:'The resolved 3D structure can sometimes be inaccurate <a href="http://blog.molview.org/2016/10/10/issues-in-3d-resolving/" target="_blank">Read more</a>',switch_engine:"Loading engine&hellip;",compound:"Loading compound&hellip;",macromolecule:"Loading macromolecule&hellip;",crystal:"Loading crystal&hellip;",crystal_structure:"Loading crystal structure&hellip;",search:"Searching&hellip;",clean:"Cleaning&hellip;",resolve:"Updating&hellip;",model_update:"Updating&hellip;",init_jmol:"Initializing Jmol&hellip;",jmol_calculation:"Calculation in progress&hellip;",no_webgl_support:Detector.getWebGLErrorMessage(),mobile_old_no_macromolecules:"Macromolecules cannot be viewed on your device",no_glmol_crystals:"You cannot view crystals using GLmol",glmol_and_jmol_only:"This feature is only available in GLmol and Jmol",glmol_only:"This feature is only available in GLmol",no_jmol_chain_type:"The current chain representation is not supported by Jmol",no_chemdoodle_chain_type:"The current chain representation is not supported by ChemDoodle",no_chemdoodle_chain_color:"The current chain representation is not supported by ChemDoodle",smiles_load_error:"Failed to load structure from sketcher",smiles_load_error_force:"Failed to load structure from sketcher",load_fail:"Failed to load structure from its database",search_fail:"The database did not return any records",search_notfound:"The database could not find any matches",structure_search_fail:"Structure search has failed",remote_noreach:"Remote database is not reachable",crystal_2d_fail:"Failed to resolve a 2D representation of this crystal structure",no_protein:"The current 3D model is not a protein",permDismiss:["crystal_2d_unreliable","resolved_3d_unreliable"],dontShowAgain:function(a){Preferences.set("messages",a,!0)},process:function(a,b){var c=!0;if("model_update"!==b||Messages.isEmpty()){if(Messages.clear(),b&&""!==b&&Messages[b]&&""!==Messages[b]){$("body").addClass("progress-cursor");var d=$("<div/>").addClass("message");$("<div/>").addClass("message-text").html(Messages[b]).appendTo(d),d.appendTo($("#messages"))}}else c=!1;return window.setTimeout(a,300),c},alert:function(a,b){if("no_canvas_support"===a)return void(window.location=window.location.origin+window.location.pathname+"htmlCanvas");if($("body").removeClass("progress-cursor"),!Preferences.get("messages",a,!1)){var c=$("<div/>").addClass("message alert-message"),d=$("<div/>").addClass("message-text").html(Messages[a]||a);b&&d.append('<span class="error-message">'+(b.message||b.detailMessage||b)+"</span>"),d.appendTo(c),$('<button class="message-close-btn">OK</button>').on(MolView.trigger,function(){$(this).parent().remove()}).appendTo(c),Messages.permDismiss.indexOf(a)!==-1&&$('<button class="message-close-btn">Don\'t show again</button>').on(MolView.trigger,function(){$(this).parent().remove(),Messages.dontShowAgain(a)}).appendTo(c),c.appendTo($("#messages"))}this.clear(),Progress.complete()},clear:function(a){$("body").removeClass("progress-cursor"),$("#messages").children().each(function(){$(this).hasClass("alert-message")||$(this).remove()})},isEmpty:function(){return $("#messages").is(":empty")},size:function(){return $("#messages .message").length}},GLmolPlugin={ready:!1,view:void 0,currentModel:"",bondsCalculated:!1,init:function(a){return Detector.canvas?(this.view=new GLmol("glmol",!Detector.webgl,Model.pixelMult,Model.bg.hex),this.view.defineRepresentation=function(){var a=this.getAllAtoms();Model.displayBU&&""!==this.protein.biomtChains&&(a=this.getChain(a,this.protein.biomtChains));var b=this.getHetatms(a),c=this.removeSolvents(b),d=Model.chain,e=new THREE.Object3D;if(this.colorByAtom(a,{}),Model.isPDB()){"ss"===d.color?this.colorByStructure(a,13369548,52428,13421772):"spectrum"===d.color?this.colorChainbow(a):"chain"===d.color?this.colorByChain(a,!0):"residue"===d.color?this.colorByResidue(a,GLmolAminoColors):"polarity"===d.color?this.colorByPolarity(a,13369344,13421772):"bfactor"===d.color&&this.colorByBFactor(a);var f=!1;"ribbon"===d.type?(this.drawCartoon(e,a,f),this.drawCartoonNucleicAcid(e,a)):"cylinders"===d.type?(this.drawHelixAsCylinder(e,a,1.6),this.drawCartoonNucleicAcid(e,a)):"btube"===d.type?(this.drawMainchainTube(e,a,"CA"),this.drawMainchainTube(e,a,"O3'")):"ctrace"===d.type&&(this.drawMainchainCurve(e,a,this.curveWidth,"CA",1),this.drawMainchainCurve(e,a,this.curveWidth,"O3'",1)),d.bonds&&(Model.GLmol.bondsCalculated||(Model.GLmol.bondsCalculated=!0,this.calculateBonds()),this.drawBondsAsLine(e,a,this.lineWidth))}Model.displayBU&&Model.isPDB()||(this.canvasVDW=!1,this.canvasLine=!1,"balls"===Model.representation?(this.canvasAtomRadius=.4,this.canvasBondWidth=.3,this.drawBondsAsStick(this.modelGroup,c,this.cylinderRadius/2,5*this.cylinderRadius,!0,.3)):"stick"===Model.representation?(this.canvasAtomRadius=.3,this.canvasBondWidth=.6,this.drawBondsAsStick(this.modelGroup,c,this.cylinderRadius,this.cylinderRadius)):"vdw"===Model.representation?(this.canvasVDW=!0,this.canvasAtomRadius=.5,this.canvasBondWidth=.3,this.drawAtomsAsSphere(this.modelGroup,c,this.sphereRadius)):"wireframe"===Model.representation?(this.canvasAtomRadius=.2,this.canvasLine=!0,this.drawBondsAsStick(this.modelGroup,c,this.cylinderRadius/8,8*this.cylinderRadius,!0,.05)):"line"===Model.representation&&(this.canvasAtomRadius=0,this.canvasLine=!0,this.drawBondsAsLine(this.modelGroup,c,this.lineWidth))),Model.isPDB()&&(Model.displayBU&&this.drawSymmetryMates2(this.modelGroup,e,this.protein.biomtMatrices),this.modelGroup.add(e))},Model._setRenderEngine("GLmol"),this.ready=!0,a&&a(),!0):(Messages.alert("no_canvas_support"),!1)},resize:function(){this.view&&$("#glmol").sizeChanged()&&($("#glmol").saveSize(),this.view.resize())},reset:function(){this.view&&(this.view.zoom2D=30,this.view.zoomInto(this.view.getAllAtoms()),this.view.redraw())},setRepresentation:function(){this.view&&(this.view.rebuildScene(),this.view.redraw())},setBackground:function(a){this.view.setBackground(a),this.view.redraw()},loadMOL:function(a){this.currentModel!==a&&this.view&&(this.currentModel=a,this.view.loadSDF(a))},loadPDB:function(a){return this.currentModel===a?(this.view.protein.appliedMatrix=void 0,void this.view.zoomInto(this.view.getAllAtoms())):void(this.view&&(this.bondsCalculated=!1,this.currentModel=a,this.view.loadPDB(a)))},setAssembly:function(){this.view&&(this.view.rebuildScene(),Model.displayBU||(this.view.protein.appliedMatrix=void 0),this.view.zoomInto(Model.GLmol.view.getAllAtoms()),this.view.redraw())},setChainColor:function(a){var b=Messages.process(function(){Model.GLmol.setRepresentation.call(Model.GLmol),b&&Messages.clear()},"glmol_update")},toDataURL:function(){if(this.view){this.view.setBackground(0,0),this.view.draw();var a="";return a=this.view.webglFailed?document.getElementById("glmol").firstChild.toDataURL("image/png"):this.view.renderer.domElement.toDataURL("image/png"),this.view.setBackground(Model.bg.hex),this.view.redraw(),a}return""}},JmolScripts={basicSettings:"",select:{molecules:"select *; select remove protein or nucleic;",macromolecules:"select protein or nucleic;"},mol:{balls:"wireframe 0.09; spacefill 25%;",stick:"wireframe 0.4; spacefill 0;",vdw:"spacefill 100%;",wireframe:"wireframe 0.03; spacefill 0.08;",line:"wireframe on; spacefill off;"},pdb:{none:"wireframe only; wireframe off;",ribbon:"ribbon only;",ctrace:"backbone only;",bonds:"wireframe on;",ss:"color atoms cpk;color ribbon [xcccccc]; color backbone [xcccccc];select helix; color ribbon [xcc00cc]; color backbone [xcc00cc];select sheet; color ribbon [x00cccc]; color backbone [x00cccc];select nucleic; color ribbon red; color backbone red;",spectrum:"color atoms group; color ribbon group; color backbone group;",chain:"color atoms chain; color ribbon chain; color backbone chain;",residue:"color atoms amino; color ribbon amino; color backbone amino;",polarity:"color [xcccccc]; color ribbon [xcccccc]; select polar; color ribbon [xcc0000]; color [xcc0000];",bfactor:"color atoms cpk; color ribbons relativeTemperature; color backbone fixedTemperature;",hideSolvents:"display not solvent;"},resetLabels:"select *; hover off; color measures magenta; font measure 18;",clearMeasures:"measure off; measure delete;",clearMolecule:'isosurface off; echo ""; label ""; select formalCharge <> 0; label %C; select *; dipole bond delete; dipole molecular delete; color cpk;'},JSmolPlugin={ready:!1,readyCB:void 0,hq:!0,picking:"OFF",currentModel:"",init:function(a){if(void 0!==Jmol)return delete Jmol._tracker,Detector.canvas?(this.readyCB=a,Messages.process(function(){Jmol.setDocument(!1),Jmol.getApplet("JSmol",{width:$("#model").width(),height:$("#model").height(),debug:!1,showfrank:!1,disableJ2SLoadMonitor:!0,disableInitialConsole:!0,allowJavaScript:!0,use:"HTML5",j2sPath:MolView.JMOL_J2S_PATH,script:'unbind _setMeasure; unbind "MIDDLE DRAG" "_rotateZorZoom"; bind "MIDDLE DRAG" "_translate";frank off; set specular off;background '+Model.bg.jmol+"; color label "+Model.bg.jmol+";background echo "+Model.bg.jmol+"; color echo "+Model.bg.jmol+';set antialiasDisplay true; set disablePopupMenu true; set showunitcelldetails false;set hoverDelay 0.001; hover off; font measure 18; font echo 18 serif bold; set echo top left;set MessageCallback "Model.JSmol.MessageCallback";set MinimizationCallback "Model.JSmol.MinimizationCallback";',readyFunction:Model.JSmol.ReadyCallback.bind(Model.JSmol),console:"none"}),$("#jsmol").html(Jmol.getAppletHtml(JSmol))},"init_jmol"),!0):(Messages.alert("no_canvas_support"),!1)},ReadyCallback:function(){this.ready=!0,this.setQuality(this.hq),Model._setRenderEngine("JSmol"),Messages.clear(),this.readyCB&&this.readyCB()},MessageCallback:function(a,b){if(b.toLowerCase().indexOf("initial mmff e")>-1&&b.toLowerCase().indexOf("max steps = 0")>-1){var c=b.split(/ +/);Model.JSmol.print("Energy = "+c[5]+" kJ")}},MinimizationCallback:function(a,b){"done"===b&&(Model.JSmol._setQuality(Model.JSmol.hq),Messages.clear())},script:function(a){this.ready&&Jmol.script(JSmol,a)},scriptWaitOutput:function(a){this.ready&&Jmol.scriptWaitOutput(JSmol,a)},print:function(a){this.ready&&Model.JSmol.script('echo "'+a+'";')},resize:function(){this.ready&&$("#jsmol").sizeChanged()&&($("#jsmol").saveSize(),Jmol.resizeApplet(JSmol,[$("#model").width(),$("#model").height()]))},reset:function(){this.ready&&(Model.JSmol.clean(),Model.JSmol.scriptWaitOutput("reset;"),Model.isCIF()&&Model.JSmol.scriptWaitOutput("rotate best;"))},setRepresentation:function(){if(this.ready){if(this.scriptWaitOutput(JmolScripts.select.molecules),this.scriptWaitOutput(JmolScripts.mol[Model.representation]),Model.isPDB()){var a=Model.chain.type;oneOf(a,["ribbon","ctrace","none"])||(a="ribbon",Messages.alert("no_jmol_chain_type")),this.scriptWaitOutput(JmolScripts.select.macromolecules),this.scriptWaitOutput(JmolScripts.pdb[a]),Model.chain.bonds&&this.scriptWaitOutput(JmolScripts.pdb.bonds),this.scriptWaitOutput(JmolScripts.pdb[Model.chain.color]),this.scriptWaitOutput(JmolScripts.pdb.hideSolvents)}this.scriptWaitOutput(JmolScripts.resetLabels)}},setBackground:function(a){this.ready&&Model.JSmol.scriptWaitOutput("\t\t\t\tbackground "+a+"; color label "+a+";\t\t\t\tbackground echo "+a+"; color echo "+a+";\t\t\t\tset echo top left; font echo 18 serif bold; refresh;")},loadMOL:function(a){return this.currentModel!==a&&(this.ready?(this.currentModel=a,this._setMeasure("OFF"),JSmol._loadMolData(a),this.setRepresentation(Model.representation),!0):void 0)},loadPDB:function(a){return this.currentModel!==a&&(this.ready?(this.currentModel=a,this._setMeasure("OFF"),this.scriptWaitOutput("set defaultLattice {0 0 0};"),this.scriptWaitOutput("set showUnitcell false;"),JSmol.__loadModel(a),this.setRepresentation(Model.representation),!0):void 0)},loadCIF:function(a,b){return this.currentModel!==a+b&&(this.ready?(this.currentModel=a+b,this._setMeasure("OFF"),b=b||[1,1,1],this.scriptWaitOutput("set defaultLattice {"+b.join(" ")+"};"),JSmol.__loadModel(a),this.scriptWaitOutput("set showUnitcell "+(b.reduce(function(a,b){return a*b})>1?"false":"true")),this.setRepresentation(Model.representation),this.scriptWaitOutput("rotate best;"),!0):void 0)},setQuality:function(a,b){$("#action-jmol-hq").removeClass("checked"),a&&$("#action-jmol-hq").addClass("checked"),this.hq=a,this._setMeasure("OFF",!0),this._setQuality(a,b)},_setQuality:function(a,b){this.scriptWaitOutput("set antialiasDisplay "+(a&&!b?"true":"false")+"; set platformSpeed "+(b&&a?2:a?4:1)+"; set ribbonBorder "+(a&&!b?"on":"off"))},safeCallback:function(a,b,c){Model.setRenderEngine("JSmol",function(){Messages.process(function(){a(),c||Messages.clear()},b)})},clean:function(){this.script(JmolScripts.clearMeasures),this.script(JmolScripts.clearMolecule),this.script(JmolScripts.resetLabels),this.setMeasure("OFF")},calculatePartialCharge:function(){if(this.ready&&!(parseFloat(""+Jmol.evaluate(JSmol,"{*}.partialcharge.max"))>0)){var a=Jmol.getPropertyAsArray(JSmol,"moleculeInfo.mf")[0];a.indexOf("H 1 F 1")>-1&&this.scriptWaitOutput("{fluorine and connected(1,hydrogen)}.partialCharge = '-0.47';{hydrogen and connected(1,fluorine)}.partialCharge = '0.47';"),a.indexOf("H 1 Cl 1")>-1&&this.scriptWaitOutput("{chlorine and connected(1,hydrogen)}.partialCharge = '-0.46';{hydrogen and connected(1,chlorine)}.partialCharge = '0.46';"),a.indexOf("H 1 Br 1")>-1&&this.scriptWaitOutput("{bromine and connected(1,hydrogen)}.partialCharge = '-0.42';{hydrogen and connected(1,bromine)}.partialCharge = '0.42';"),a.indexOf("H 1 I 1")>-1&&this.scriptWaitOutput("{iodine and connected(1,hydrogen)}.partialCharge = '-0.37';{hydrogen and connected(1,iodine)}.partialCharge = '0.37';"),this.scriptWaitOutput("select *; calculate partialcharge;")}},loadMEPSurface:function(a){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("isosurface vdw resolution 0 color range -.07 .07 map mep "+(a?"translucent":"opaque")+";"),Model.JSmol.script(JmolScripts.resetLabels)},"jmol_calculation"))},displayCharge:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("font label 18; color label magenta; label %-8.4[partialcharge]; hover off;")},"jmol_calculation"))},displayDipoles:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("dipole bonds on; dipole calculate bonds; hover off;")},"jmol_calculation"))},displayNetDipole:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("dipole molecular on; dipole calculate molecular; hover off;")},"jmol_calculation"))},calculateEnergyMinimization:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol.setQuality(Model.JSmol.hq,!0),Model.JSmol.script(JmolScripts.clearMolecule),Model.JSmol.script(JmolScripts.resetLabels),Model.JSmol.script("minimize;")},"jmol_calculation",!0))},setMeasure:function(a,b){this.picking!==a.toLowerCase()&&Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure(a,b)})},_setMeasure:function(a,b){this.picking!==a.toLowerCase()&&(this.picking=a.toLowerCase(),$(".jmol-picking").removeClass("checked"),"off"===this.picking?(Model.JSmol.scriptWaitOutput("set picking off;"),b||Model.JSmol._setQuality(Model.JSmol.hq)):($("#action-jmol-measure-"+this.picking).addClass("checked"),Model.JSmol._setQuality(Model.JSmol.hq,!0),Model.JSmol.scriptWaitOutput("set picking off; set picking on; set pickingStyle MEASURE ON; set picking MEASURE "+a+";")))},toDataURL:function(){return this.ready?document.getElementById("JSmol_canvas2d").toDataURL("image/png"):""}},CDWPlugin={ready:!1,view:void 0,molecule:void 0,currentModel:"",init:function(a){if(void 0!==ChemDoodle)return Detector.webgl?(this.view=new ChemDoodle.TransformCanvas3D("chemdoodle-canvas",$("#model").width()*Model.pixelMult,$("#model").height()*Model.pixelMult),$("#chemdoodle-canvas").css({width:$("#model").width(),height:$("#model").height()}),this.view.specs.macromolecules_ribbonCartoonize=this.view.specs.proteins_ribbonCartoonize=!0,this.view.specs.backgroundColor=Model.bg.html,this.view.specs.crystals_unitCellColor=Model.fg.html,Model._setRenderEngine("CDW"),this.ready=!0,a&&a(),!0):(Messages.alert("no_webgl_support"),!1)},resize:function(){this.view&&$("#chemdoodle").sizeChanged()&&($("#chemdoodle").saveSize(),this.view.resize($("#model").width()*Model.pixelMult,$("#model").height()*Model.pixelMult),$("#chemdoodle-canvas").css({width:$("#model").width(),height:$("#model").height()}),void 0!==this.molecule&&this.view.loadMolecule(this.molecule))},reset:function(){this.view&&(this.view.rotationMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.view.repaint())},setRepresentation:function(){var a=Model.representation;"balls"===a?a="Ball and Stick":"stick"===a?a="Stick":"vdw"===a?a="van der Waals Spheres":"wireframe"===a?a="Wireframe":"line"===a&&(a="Line"),this.view.specs.set3DRepresentation(a),"Ball and Stick"===a&&(this.view.specs.bonds_cylinderDiameter_3D=.2),this.view.specs.backgroundColor=Model.bg.html,this.view.specs.crystals_unitCellColor=Model.fg.html,this.view.specs.bonds_useJMOLColors=!0,Model.isPDB()&&(("ribbon"!==Model.chain.type||Model.chain.bonds)&&Messages.alert("no_chemdoodle_chain_type"),"bfactor"===Model.chain.color&&Messages.alert("no_chemdoodle_chain_color"),this.view.specs.macro_colorByChain="chain"===Model.chain.color,"spectrum"===Model.chain.color?this.view.specs.proteins_residueColor="rainbow":"residue"===Model.chain.color?this.view.specs.proteins_residueColor="amino":"polarity"===Model.chain.color?this.view.specs.proteins_residueColor="polarity":this.view.specs.proteins_residueColor="none"),this.view.repaint()},setBackground:function(a,b,c){this.view.specs.backgroundColor=b,this.view.specs.crystals_unitCellColor=c,this.view.gl.clearColor(a[0]/255,a[1]/255,a[2]/255,1),this.view.repaint()},loadMOL:function(a){this.currentModel!==a&&this.view&&(this.currentModel=a,this.molecule=ChemDoodle.readMOL(a,1),this.view.specs.projectionPerspective_3D=!0,this.view.specs.compass_display=!1,this.view.loadMolecule(this.molecule))},loadPDB:function(a){this.currentModel!==a&&this.view&&(this.currentModel=a,this.molecule=ChemDoodle.readPDB(a),this.view.specs.projectionPerspective_3D=!0,this.view.specs.compass_display=!1,this.view.loadMolecule(this.molecule))},loadCIF:function(a,b){this.currentModel!==a+b&&this.view&&(this.currentModel=a+b,b=b||[1,1,1],this.view.specs.crystals_displayUnitCell=1===b.reduce(function(a,b){return a*b}),this.view.specs.projectionPerspective_3D=!1,this.view.specs.compass_display=!0,this.molecule=ChemDoodle.readCIF(a,b[0],b[1],b[2]),this.view.loadMolecule(this.molecule))},toDataURL:function(){if(this.view){this.view.gl.clearColor(0,0,0,0),this.view.repaint();var a=this.view.gl.canvas.toDataURL("image/png");return this.view.gl.clearColor(Model.bg.rgb[0]/255,Model.bg.rgb[1]/255,Model.bg.rgb[2]/255,1),a}return""}},Model={data:{mol:"",pdb:"",cif:"",current:"MOL"},representation:"balls",displayBU:!1,chain:{type:"ribbon",bonds:!1,color:"ss"},bg:{colorName:"black",hex:0,rgb:[0,0,0],jmol:"[0,0,0]",html:"rgb(0,0,0)"},fg:{html:"rgb(255,255,255)"},engine:void 0,GLmol:GLmolPlugin,JSmol:JSmolPlugin,CDW:CDWPlugin,pixelMult:1,init:function(a,b){if(this.pixelMult=MolView.devicePixelRatio,this.setBackground(Preferences.get("model","background","black")),!(this.GLmol&&this.JSmol&&this.CDW))throw new Error("Not all Model plugins are loaded");MolView.loadDefault&&(this.data.mol=defaultMol3D||""),this.setRenderEngine(b||"GLmol",a)},preloadQuery:function(a,b){var c=this;$.each(a,function(a,b){"mode"===a?oneOf(b,["balls","stick","vdw","wireframe","line"])&&($(".r-mode").removeClass("checked"),
$("#action-model-"+b).addClass("checked"),c.representation=b):"chainType"===a?(oneOf(b,["ribbon","cylinders","btube","ctrace"])&&($(".chain-type").removeClass("checked"),$("#action-chain-type-"+b).addClass("checked"),c.chain.type=b),"bonds"===b&&($(".chain-type").removeClass("checked"),c.chain.type="none",c.chain.bonds=!0)):"chainBonds"===a?c.chain.bonds=!0:"chainColor"===a&&oneOf(b,["ss","spectrum","chain","residue","polarity","bfactor"])&&($(".chain-color").removeClass("checked"),$("#action-chain-color-"+b).addClass("checked"),c.chain.color=b)})},isGLmol:function(){return"GLmol"===Model.engine},isJSmol:function(){return"JSmol"===Model.engine},isCDW:function(){return"CDW"===Model.engine},isMOL:function(){return"MOL"===Model.data.current},isPDB:function(){return"PDB"===Model.data.current},isCIF:function(){return"CIF"===Model.data.current},resize:function(){this.isGLmol()?this.GLmol.resize():this.isJSmol()?this.JSmol.resize():this.isCDW()&&this.CDW.resize()},reset:function(){this.isGLmol()?this.GLmol.reset():this.isJSmol()?this.JSmol.reset():this.isCDW()&&this.CDW.reset()},setRenderEngine:function(a,b){if(this.engine===a)return void(b&&b());if("GLmol"===a){if(this.isCIF())return void Messages.alert("no_glmol_crystals");if(this.GLmol.ready)this._setRenderEngine(a),b&&b();else if(!this.GLmol.init(b))return}else if("JSmol"===a){if(this.JSmol.ready)this._setRenderEngine(a),b&&b();else if(!this.JSmol.init(b))return}else if("CDW"===a)if(this.CDW.ready)this._setRenderEngine(a),b&&b();else if(!this.CDW.init(b))return;$("#action-engine-glmol").removeClass("checked"),$("#action-engine-jmol").removeClass("checked"),$("#action-engine-cdw").removeClass("checked"),$("#action-engine-"+("GLmol"===a?"glmol":"JSmol"===a?"jmol":"CDW"===a?"cdw":"")).addClass("checked")},_setRenderEngine:function(a){$("#glmol").css("display","GLmol"===a?"block":"none"),$("#jsmol").css("display","JSmol"===a?"block":"none"),$("#chemdoodle").css("display","CDW"===a?"block":"none"),this.engine=a,this.resize(),this.isGLmol()?this.GLmol.setBackground(this.bg.hex):this.isJSmol()?this.JSmol.setBackground(this.bg.jmol):this.isCDW()&&this.CDW.setBackground(this.bg.rgb,this.bg.html,this.fg.html),this.loadContent()||(this.isGLmol()?this.GLmol.setRepresentation():this.isJSmol()?this.JSmol.setRepresentation():this.isCDW()&&this.CDW.setRepresentation())},setRepresentation:function(a){oneOf(a,["balls","stick","vdw","wireframe","line"])&&($(".r-mode").removeClass("checked"),$("#action-model-"+a).addClass("checked"),this.representation=a,window.setTimeout(function(){this.isGLmol()?this.GLmol.setRepresentation():this.isJSmol()?this.JSmol.setRepresentation():this.isCDW()&&this.CDW.setRepresentation()}.bind(this),300))},setChainType:function(a,b){if(oneOf(a,["ribbon","cylinders","btube","ctrace"]))if(this.isPDB()||b)if(this.isGLmol()||this.isJSmol()&&oneOf(a,["ribbon","ctrace","none"])||this.isCDW()&&"ribbon"===a){$(".chain-type").removeClass("checked"),$("#action-chain-type-"+a).addClass("checked"),this.chain.type=a;var c=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.JSmol.setRepresentation(),c&&Messages.clear()},"model_update")}else Messages.alert(oneOf(a,["ribbon","ctrace","none"])?"glmol_and_jmol_only":"glmol_only");else Messages.alert("no_protein")},setChainBonds:function(a,b){if(this.isPDB()||b)if(this.isGLmol()||this.isJSmol()||this.isCDW()&&!a){$("#action-chain-type-bonds").toggleClass("checked",a),this.chain.bonds=a;var c=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.JSmol.setRepresentation(),c&&Messages.clear()},"model_update")}else Messages.alert("glmol_and_jmol_only");else Messages.alert("no_protein")},setChainColor:function(a,b){if(this.isPDB()||b)if(this.isGLmol()||this.isJSmol()||this.isCDW()&&"bfactor"!==a){$(".chain-color").removeClass("checked"),$("#action-chain-color-"+a).addClass("checked"),this.chain.color=a;var c=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.isJSmol()?Model.JSmol.setRepresentation():Model.CDW.setRepresentation(),c&&Messages.clear()},"model_update")}else Messages.alert("glmol_and_jmol_only");else Messages.alert("no_protein")},setBackground:function(a){return Preferences.set("model","background",a),this.bg.colorName=a,this.bg.hex="white"!==a?"gray"!==a?0:13421772:16777215,this.bg.rgb=[this.bg.hex>>16,this.bg.hex>>8&255,255&this.bg.hex],this.bg.jmol="["+this.bg.rgb.join()+"]",this.bg.html="rgb("+this.bg.rgb.join()+")",this.fg.html="rgb("+(255-this.bg.rgb[0])+","+(255-this.bg.rgb[0])+","+(255-this.bg.rgb[0])+")",$(".model-bg").removeClass("checked"),$("#action-model-bg-"+a).addClass("checked"),$("#model").css("background",this.bg.html),this.isGLmol()?this.GLmol.setBackground(this.bg.hex):this.isJSmol()?this.JSmol.setBackground(this.bg.jmol):this.isCDW()?this.CDW.setBackground(this.bg.rgb,this.bg.html,this.fg.html):void 0},setBioAssembly:function(a){if(this.isGLmol())if(this.isPDB()){$("#action-bio-assembly").text(a?"Show assymetic unit":"Show bio assembly"),this.displayBU=a;var b=Messages.process(function(){Model.GLmol.setAssembly(a),b&&Messages.clear()},"model_update")}else Messages.alert("no_protein");else Messages.alert("glmol_only")},loadContent:function(){return this.isMOL()?this._loadMOL(this.data.mol):this.isPDB()?this._loadPDB(this.data.pdb):!!this.isCIF()&&this._loadCIF(this.data.cif)},loadMOL:function(a){this.data.current="MOL",this.data.mol=a,$("#action-export-model").text("MOL file"),$(".jmol-script").removeClass("disabled"),this._loadMOL(a)},_loadMOL:function(a){return this.isGLmol()?this.GLmol.loadMOL(a):this.isJSmol()?this.JSmol.loadMOL(a):this.isCDW()?this.CDW.loadMOL(a):void 0},loadPDB:function(a){this.data.current="PDB",this.data.pdb=a,$("#action-export-model").text("PDB file"),$(".jmol-script").addClass("disabled"),this._loadPDB(a)},preloadPDB:function(a,b){this.data.current="PDB",this.data.pdb=a,$("#action-export-model").text("PDB file"),$(".jmol-script").addClass("disabled")},_loadPDB:function(a){return this.displayBU=!1,$("#action-bio-assembly").text("Show bio assembly"),this.isGLmol()?this.GLmol.loadPDB(a):this.isJSmol()?this.JSmol.loadPDB(a):this.isCDW()?this.CDW.loadPDB(a):void 0},loadCIF:function(a,b,c){this.data.current="CIF",this.data.cif=a,$("#action-export-model").text("CIF file"),$(".jmol-script").removeClass("disabled"),$(".jmol-calc").addClass("disabled"),this._loadCIF(a,b,c)},_loadCIF:function(a,b,c){b=b||[1,1,1],this.isGLmol()?Detector.webgl?this.setRenderEngine("CDW",function(){Model.CDW.loadCIF(Model.data.cif,b),c&&c()}):this.setRenderEngine("JSmol",function(){Model.JSmol.loadCIF(Model.data.cif,b),c&&c()}):this.isJSmol()?(this.JSmol.loadCIF(a,b),c&&c()):this.isCDW()&&(Detector.webgl?(this.CDW.loadCIF(a,b),c&&c()):this.setRenderEngine("JSmol",function(){Model.JSmol.loadCIF(Model.data.cif,b),c&&c()}))},getImageDataURL:function(){var a="";return this.isGLmol()?a=this.GLmol.toDataURL():this.isJSmol()?a=this.JSmol.toDataURL():this.isCDW()&&(a=this.CDW.toDataURL()),a},getFileBlob:function(){var a;return this.isMOL()?a=new Blob([this.data.mol],{type:"chemical/x-mdl-molfile"}):this.isPDB()?a=new Blob([this.data.pdb],{type:"chemical/x-pdb"}):this.isCIF()&&(a=new Blob([this.data.cif],{type:"chemical/x-cif"})),a},getFileExstension:function(){return Model.data.current}},Request={HTTP_CLIENT_IP:"",HTTP_ACCEPT_LANGUAGE:"",API_ROOT:"",alternativeLanguages:[],init:function(){for(var a=this.HTTP_ACCEPT_LANGUAGE.split(","),b=0;b<a.length;b++){var c=a[b].substr(0,2);"en"!==c&&Request.alternativeLanguages.push(c)}},translation:function(a,b){Request.alternativeLanguages.length>0&&a.length>0?AJAX({dataType:"json",url:"https://mymemory.translated.net/api/get?q="+encodeURI(a)+"&langpair="+Request.alternativeLanguages[0]+"|en&de=hermanbergwerf@gmail.com&ip="+Request.HTTP_CLIENT_IP,success:function(c){for(var d=0;d<c.matches.length;d++)if(c.matches[d].translation===a)return void b(a);b(c.responseData.translatedText)},error:function(){b(a)}}):b(a)},CIRsearch:function(a,b,c){return""===a?void c():void Request.CIR.resolve(a,!1,function(d){Progress.increment(),Request.CIR.resolve(a,!0,function(c){b(c,d,a)},c)},function(){Progress.increment(),Request.translation(a,function(d){Progress.increment(),a=d,Request.CIR.resolve(a,!1,function(d){Progress.increment(),Request.CIR.resolve(a,!0,function(c){b(c,d,a)},c)},c)})},c)},CIRsearch3D:function(a,b,c){return""===a?void c():void Request.CIR.resolve(a,!1,function(c){Progress.increment(),b(c,a)},function(){Progress.increment(),Request.translation(a,function(d){Progress.increment(),a=d,Request.CIR.resolve(a,!1,function(c){b(c,a)},c)})},c)},resolve:function(a,b,c,d,e){function f(b){b>0?Request.PubChem.sdf(b,c,function(a){d(a,b)},function(){Progress.increment(),Request.CIR.resolve(a,c,function(a){d(a,c?-1:b)},e)}):Request.CIR.resolve(a,c,function(a){d(a,-1)},e)}0===b?Request.PubChem.smilesToCID(a,function(a){Progress.increment(),f(a)},function(){Progress.increment(),f(-1)}):f(b)},CIR:{available:!1,resolve:function(a,b,c,d){return Request.CIR.available?(a=a.replace(/#/g,"%23").replace(/\\/g,"%5C"),void AJAX({primary:!0,dataType:"text",url:"https://cactus.nci.nih.gov/chemical/structure/"+a+"/file?format=sdf&get3d="+(b?"False":"True"),defaultError:d,success:function(a){"<h1>Page not found (404)</h1>\n"===a||void 0===a?d():c(a)}})):void d()},property:function(a,b,c,d){return Request.CIR.available?(a=a.replace(/#/g,"%23").replace(/\\/g,"%5C"),void AJAX({dataType:"text",url:"https://cactus.nci.nih.gov/chemical/structure/"+a+"/"+b,defaultError:d,success:function(a){if("<h1>Page not found (404)</h1>\n"===a||void 0===a)d&&d();else{var e=a.split("\n"),f=e[0];"cas"===b?(e.sort(function(a,b){return a.length>b.length}),f=e[0]):"stdinchikey"===b&&(f=f.substr(9)),c(f)}}})):void d()}},PubChem:{data:[],maxRecords:50,MaxSeconds:10,search:function(a,b,c){return""===a?void(c&&c()):(Progress.increment(),void AJAX({primary:!0,dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+encodeURIComponent(a)+"/cids/json?name_type=word",defaultError:c,success:function(a){Progress.increment(),Request.PubChem.data=a.IdentifierList.CID,b()}}))},structureSearch:function(a,b,c,d,e){AJAX({primary:!0,dataType:"json",url:"smiles"===a?"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/"+c+"/"+a+"/json?"+a+"="+encodeURIComponent(b)+"&MaxRecords="+Request.PubChem.maxRecords+"&MaxSeconds="+Request.PubChem.MaxSeconds:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/"+c+"/"+a+"/"+b+"/json?MaxRecords="+Request.PubChem.maxRecords+"&MaxSeconds="+Request.PubChem.MaxSeconds,defaultError:e,success:function(a){d(a.Waiting.ListKey)}})},list:function(a,b,c,d){AJAX({primary:!0,dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/listkey/"+a+"/cids/json",defaultError:d,success:function(a){a.IdentifierList?(Request.PubChem.data=a.IdentifierList.CID,b()):a.Waiting?c(a.Waiting.ListKey):a.Fault&&d&&d()}})},smilesToCID:function(a,b,c){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/cids/json?smiles="+encodeURIComponent(a),defaultError:c,success:function(a){a.IdentifierList&&a.IdentifierList.CID[0]>0?b(a.IdentifierList.CID[0]):c()}})},nameToCID:function(a,b,c){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+a+"/cids/json",defaultError:c,success:function(a){a.IdentifierList?b(a.IdentifierList.CID[0]):c()}})},primaryName:function(a,b,c){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+a+"/description/json",defaultError:c,success:function(a){a.InformationList?b(a.InformationList.Information[0].Title):c&&c()}})},description:function(a,b,c){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+a+"/description/json",defaultError:c,success:b})},properties:function(a,b,c,d){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+a+"/property/"+b+"/json",defaultError:d,success:c})},casNumber:function(a,b,c){AJAX({dataType:"text",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+a+"/synonyms/txt",defaultError:c,success:function(a){for(var d=/^\d{2,7}-\d{2}-\d$/gm,e=[],f={};null!==(f=d.exec(a));)e.push(f[0]);e.length>0?(e.sort(function(a,b){return a.length>b.length}),b(e[0])):c()}})},image:function(a,b){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+a+"/png?record_type=2d&image_size="+(Math.round(b)||300)*MolView.devicePixelRatio+"x"+(Math.round(b)||300)*MolView.devicePixelRatio},smilesToImage:function(a){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/png?record_type=2d&smiles="+encodeURIComponent(a)+"&image_size="+300*MolView.devicePixelRatio+"x"+300*MolView.devicePixelRatio},sdf:function(a,b,c,d){AJAX({primary:!0,dataType:"text",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+a+"/sdf?record_type="+(b?"2d":"3d"),defaultError:d,success:c})},staticURL:function(a){return"https://pubchem.ncbi.nlm.nih.gov/compound/"+a}},RCSB:{data:[],search:function(a,b,c){return""===a?void(c&&c()):(Progress.increment(),a=a.replace(/\s/g,"|"),void AJAX({primary:!0,type:"POST",data:"<orgPdbQuery><queryType>org.pdb.query.simple.AdvancedKeywordQuery</queryType><description>Text search for: "+a+"(molview.org)</description><keywords>"+a+"</keywords></orgPdbQuery>",contentType:"application/x-www-form-urlencoded",dataType:"text",url:"http://www.rcsb.org/pdb/rest/search?sortfield=rank",defaultError:c,success:function(a){Progress.increment(),Request.RCSB.data=a.split(/\n/),Request.RCSB.data=Request.RCSB.data.filter(function(a){return""!==a}),Request.RCSB.data.reverse(),Request.RCSB.data.length>0?b():c&&c()}}))},information:function(a,b,c){AJAX({primary:!0,dataType:"text",url:"http://www.rcsb.org/pdb/rest/customReport?pdbids="+a.join()+"&customReportColumns=structureId,structureTitle",defaultError:c,success:function(c){var d,e={dataset:[]},f=[],g=$(c).find("record");for(d=0;d<g.length;d++)f.push({structureId:$(g[d]).find("dimStructure\\.structureId").text(),structureTitle:$(g[d]).find("dimStructure\\.structureTitle").text()});for(d=0;d<a.length;d++)for(var h=0;h<f.length;h++)f[h].structureId!==a[d]||e.dataset.push(f[h]);b(e)}})},image:function(a){return"http://www.rcsb.org/pdb/images/"+a+"_bio_r_500.jpg"},PDB:function(a,b,c){AJAX({primary:!0,dataType:"text",url:"https://files.rcsb.org/view/"+a+".pdb",defaultError:c,success:b})},staticURL:function(a){return"http://www.rcsb.org/pdb/explore/explore.do?structureId="+a}},COD:{data:{records:[]},search:function(a,b,c){return""===a?void(c&&c()):(Progress.increment(),void AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/search/"+encodeURIComponent(a),defaultError:c,success:function(a){Progress.increment(),a.error?c&&c(!0):a.records&&a.records.length>0?(Request.COD.data=a.records,b()):c&&c(!1)}}))},smiles:function(a,b,c){AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/smiles/"+a,defaultError:c,success:b})},name:function(a,b,c){AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/name/"+a,defaultError:c,success:b})},CIF:function(a,b,c){AJAX({primary:!0,dataType:"text",url:"https://molview.org/api/cod/cif/"+a+".cif",defaultError:c,success:b})},staticURL:function(a){return"http://www.crystallography.net/"+a+".html"}},NMRdb:{prediction:function(a,b,c){AJAX({dataType:"json",url:"http://www.nmrdb.org/service/prediction?smiles="+encodeURIComponent(a),defaultError:c,success:function(a){b(a.jcamp.value)}})}},NIST:{lookup:function(a,b,c){AJAX({dataType:"json",url:Request.API_ROOT+"api/nist/lookup/"+a,defaultError:c,success:function(a){var c=[];c.url=a.url,c.mass=a.mass,c.uvvis=a.uvvis,c.ir=new Array,a.ir.sort(function(a,b){return a.i>b.i});for(var d=0;d<a.ir.length;d++)if(a.ir[d].source.indexOf("NO SPECTRUM")===-1){var e=humanize(a.ir[d].state);c.ir.push({i:a.ir[d].i,state:e})}b(c)}})},spectrum:function(a,b,c,d){var e=-1;b.indexOf("ir")!==-1&&(e=parseInt(b.substr(3)),b="ir"),AJAX({dataType:"text",url:Request.API_ROOT+"api/nist/"+b+"/"+a+(e!==-1?"/"+e:""),defaultError:d,success:c})}}};